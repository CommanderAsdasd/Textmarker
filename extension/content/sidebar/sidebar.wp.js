!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=30)}({0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._ERRORTRACKER=t._L10N=t._PORT=t._DOMMODULE=t._MODULE=t._EXTEND=t._GET_ACTIVE_TAB=t._COPY=void 0;var r=n(6),o=n(11),i=d(n(5)),a=n(1),s=n(10),u=n(3),c=d(n(9)),l=d(n(2));function d(e){return e&&e.__esModule?e:{default:e}}t._COPY=r._COPY,t._GET_ACTIVE_TAB=o._GET_ACTIVE_TAB,t._EXTEND=i.default,t._MODULE=a._MODULE,t._DOMMODULE=s._DOMMODULE,t._PORT=u._PORT,t._L10N=c.default,t._ERRORTRACKER=l.default},1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._MODULE=void 0;var r,o=n(4),i=(r=o)&&r.__esModule?r:{default:r};t._MODULE=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));for(i in e)n[i]=e[i];var r=n.events,o=void 0,i=void 0,a=void 0,s=void 0;if(r&&(o=r.ENV))for(a in o)n[s=o[a]]&&n.on(a,n.proxy(n,n[s]));return!n.autoinit||n.autoinit(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),t}()},10:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._DOMMODULE=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1);t._DOMMODULE=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e._bound={},e._extraBound=[];var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.addListenersManually||n.addListeners(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o._MODULE),r(t,[{key:"generalHandler",value:function(e,t,n){var r=n.target,o=void 0,i=void 0,a=void 0,s=void 0,u=void 0,c=void 0,l=void 0;for(o in e)if(i=o,c="."===(s=o[0]),l="*"===s,((u="#"===s)||c)&&(o=o.substr(1)),l||c&&r.classList.contains(o)||u&&r.id===o||r.nodeName.toLowerCase()===o){"function"==typeof(a=e[i])?a(n,r):this[a]&&this[a](n,r);break}}},{key:"addListener",value:function(e,t,n){n=n||this.el;var r="function"==typeof t?t:this[t];n.addEventListener(e,r,!1),n===this.el?(this._bound[e]||(this._bound[e]=[]),this._bound[e].push(r)):this._extraBound.push([n,e,r])}},{key:"addListeners",value:function(){var e=this.events,t=void 0,n=void 0,r=void 0,o=void 0,i=void 0;if(!e||!(t=e.DOM)||!(n=this.el))return!1;for(o in t)r=t[o],i=this.proxy(this,this.generalHandler,r,o),n.addEventListener(o,i,!1),this._bound[o]||(this._bound[o]=[]),this._bound[o].push(i)}},{key:"removeListeners",value:function(){var e=void 0,t=void 0,n=void 0;for(e in this._bound)for(n=(t=this._bound[e]).length;n--;)this.el.removeEventListener(e,t[n],!1),t.splice(n,1);var r=this._extraBound,o=0,i=void 0;for(n=r.length;o<n;o++)(i=r[o])[0].removeEventListener(i[1],i[2],!1)}}]),t}()},11:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t._GET_ACTIVE_TAB=function(){return browser.tabs.query({currentWindow:!0,active:!0}).then(function(e){return e[0]})}},16:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=new r._MODULE({events:{ENV:{"toggled:sync":"setAreas"}},initialized:!1,area_settings:"sync",area_history:"sync",setAreas:function(){var e=this;return browser.storage.sync.get().then(function(t){t&&t.sync&&(e.area_settings=t.sync.settings?"sync":"local",e.area_history=t.sync.history?"sync":"local")})},get:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"storage";if(!this["_get_"+t])throw"field "+t+" doesn't exist";return this.initialized?this["_get_"+t]():(this.initialized=!0,this.setAreas().then(function(){return e["_get_"+t]()}))},_get_mode:function(){return browser.storage[this.area_settings].get().then(function(e){return!(e&&e.settings&&!e.settings.addon.active)})},_get_autosave:function(){return browser.storage[this.area_settings].get().then(function(e){return!(!e||!e.settings)&&e.settings.history.autosave})},_get_settings:function(){return browser.storage[this.area_settings].get().then(function(e){return e.settings})},_get_markers:function(){return browser.storage[this.area_settings].get().then(function(e){return e.settings.markers})}})},2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=new(n(1)._MODULE)({autoinit:function(){var e=this;window.addEventListener("error",function(t){var n=t.filename.split("/").pop();["sidebar.wp.js","tbb-menu.wp.js","options.wp.js","addon-page.wp.js"].includes(n)&&e.emit("error:browser-console",{message:t.message,location:t.filename.split("/").pop().split(".").shift()+":"+t.lineno+":"+t.colno,time:(new Date).getTime()})},!1)}});t.default=r},25:function(e,t,n){"use strict";new(n(0)._DOMMODULE)({el:document.getElementById("links"),events:{DOM:{click:{".link":"link"}}},link:function(e,t){this.emit("open:addon-page",t.getAttribute("data-id"))}})},26:function(e,t,n){"use strict";var r,o=n(0),i=n(16),a=(r=i)&&r.__esModule?r:{default:r};new o._DOMMODULE({el:document.getElementById("page-actions"),events:{ENV:{"started:app":"update","updated:settings":"update","toggled:sync-settings":"update","updated:entry":"deactivateSave","saved:entry":"deactivateSave","unsaved-changes":"activateSave","added:bookmark":"activateBookmark","removed:bookmark":"deactivateBookmark","added:note":"activateNotes","removed:last-note":"deactivateNotes"},DOM:{click:{".switch-toggle":"onAutosaveSwitch",".page-action":"pageAction"}}},autoinit:function(){this.update()},update:function(){this.updateAutosave()},updateAutosave:function(){var e=this;a.default.get("autosave").then(function(t){return e.toggleAutosave(t)})},onAutosaveSwitch:function(e,t){var n=!(t="autosave-switch"===t.id?t:t.parentNode).classList.contains("active");this.toggleAutosave(n),this.emit("sidebar:toggle-autosave",n)},toggleAutosave:function(e){var t=e?"add":"remove";document.getElementById("autosave-switch").classList[t]("active"),document.getElementById("page-action-box--save").classList[t]("none")},activateSave:function(){this.activate("save",!0)},deactivateSave:function(){this.activate("save",!1)},activateBookmark:function(){this.activate("scroll",!0)},deactivateBookmark:function(){this.activate("scroll",!1)},activateNotes:function(){this.activate("notes",!0)},deactivateNotes:function(){this.activate("notes",!1)},activate:function(e,t){var n=document.getElementById("page-action--"+e);t?(n.removeAttribute("disabled"),n.parentNode.classList.remove("disabled")):(n.setAttribute("disabled",!0),n.parentNode.classList.add("disabled"))},pageAction:function(e,t){var n=this;(0,o._GET_ACTIVE_TAB)().then(function(e){return n.emit("sidebar:"+t.getAttribute("data-action"),{tab:e.id})})}})},27:function(e,t,n){"use strict";var r=n(0);new r._DOMMODULE({el:document.getElementById("mark-actions"),events:{ENV:{"clicked:mark":"activate"},DOM:{click:{".mark-action":"markAction",".i":"toggleInfo"}}},buttons:[],autoinit:function(){this.buttons=Array.from(this.el.getElementsByTagName("button"))},markAction:function(e,t){var n=this;t.hasAttribute("disabled")||((0,r._GET_ACTIVE_TAB)().then(function(e){return n.emit("sidebar:"+t.getAttribute("data-action"),null,null,{tab:e.id})}),this.deactivate())},activate:function(e){this.buttons.forEach(function(t){var n=t.getAttribute("data-action");("delete-highlight"===n||"boolean"==typeof e[n]&&!e[n]||"delete-bookmark"===n&&e.bookmark)&&(t.removeAttribute("disabled"),t.parentNode.classList.remove("disabled"))})},deactivate:function(){this.buttons.forEach(function(e){e.setAttribute("disabled",!0),e.parentNode.classList.add("disabled")})},toggleInfo:function(e,t){t.classList.toggle("active")}})},28:function(e,t,n){"use strict";var r=n(0);new r._DOMMODULE({el:document.getElementById("markers"),events:{ENV:{"started:app":"render","updated:settings":"render","toggled:sync-settings":"render","changed:selection":"toggleMarkerButtons"},DOM:{change:{".marker__color":"change"},click:{".marker__apply":"applyColor"}}},autoinit:function(){this.render()},render:function(){var e=this;browser.storage.sync.get().then(function(e){return e&&e.settings&&(!e.sync||e.sync.settings)?e.settings.markers:browser.storage.local.get().then(function(e){return e&&e.settings&&e.sync&&!e.sync.settings?e.settings.markers:null})}).then(function(t){if(!t)return e;var n=document.getElementById("markers-container"),r=document.createDocumentFragment(),o=void 0,i=void 0,a=void 0,s=void 0,u=void 0,c=void 0;for(o in n.innerText="",t)i=document.createElement("div"),a=document.createElement("label"),s=document.createElement("input"),u=document.createElement("button"),c=e.extractBgColor(t[o]),i.className="marker clearfix",a.setAttribute("for","marker-"+o),a.className="marker__label",s.className="marker__color",s.id="marker-"+o,s.name=o,s.type="color",s.value=c,u.className="marker__apply",u.setAttribute("disabled",!0),u.setAttribute("data-key",o),i.appendChild(a),i.appendChild(u),i.appendChild(s),r.appendChild(i),a.innerText="Marker "+o.toUpperCase(),c||s.setAttribute("disabled","disabled");n.appendChild(r)})},extractBgColor:function(e){for(var t=e.split(";"),n=t.length,r="",o=0,i=void 0;o<n;o++)if((i=t[o]).includes("background-color")){r=i.split(":")[1];break}return r},change:function(e,t){this.emit("change:bg-setting",t.name,t.value)},applyColor:function(e,t){var n=this;t.classList.contains("disabled")||(0,r._GET_ACTIVE_TAB)().then(function(e){return n.emit("sidebar:highlight",t.getAttribute("data-key"),{tab:e.id})})},toggleMarkerButtons:function(e){var t=e?"removeAttribute":"setAttribute";Array.from(document.getElementsByClassName("marker__apply")).forEach(function(e){return e[t]("disabled",!0)})}})},29:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=new r._PORT({name:"sidebar",type:"privileged",events:{CONNECTION:["change:bg-setting","error:browser-console","sidebar:highlight","sidebar:delete-highlight","sidebar:bookmark","sidebar:delete-bookmark","sidebar:note","sidebar:toggle-autosave","sidebar:save-changes","sidebar:undo","sidebar:redo","sidebar:scroll-to-bookmark","sidebar:toggle-notes","open:addon-page"]}})},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._PORT=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1);t._PORT=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.port=null;var r=n.type;browser.runtime.onMessage.addListener(n.proxy(n,n.passMessage)),"privileged"!==r&&"background"!==r||n.initPorting();var o=n.events,i=void 0,a=void 0;if(o){if(i=o.ONEOFF){var s=!0,u=!1,c=void 0;try{for(var l,d=i[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var f=l.value;n.on(f,n.proxy(n,n.sendMessage,f))}}catch(e){u=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw c}}}if(a=o.CONNECTION){var v=!0,p=!1,b=void 0;try{for(var g,h=a[Symbol.iterator]();!(v=(g=h.next()).done);v=!0){var y=g.value;n.on(y,n.proxy(n,n.postMessage,y))}}catch(e){p=!0,b=e}finally{try{!v&&h.return&&h.return()}finally{if(p)throw b}}}}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o._MODULE),r(t,[{key:"passMessage",value:function(e,t,n){e.args=e.args||[];var r=[].concat(e.ev,e.args);return t&&t.name||(r=r.concat(t,n)),this.emit.apply(this,r),!!e.wait}},{key:"sendMessage",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o=this.type,i={ev:e,args:n};if("content"===o)browser.runtime.sendMessage(i).catch(function(){});else if("background"===o){var a=n[n.length-1];void 0!==a&&a.tab?browser.tabs.sendMessage(a.tab,i).catch(function(){}):browser.tabs.query({}).then(function(e){var t=!0,n=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var s=o.value;browser.tabs.sendMessage(s.id,i).catch(function(){})}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}})}}},{key:"postMessage",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var o={ev:e,args:n};this.port&&this.port.postMessage(o)}},{key:"initPorting",value:function(){this.postponeConnection?this.addConnectionListeners(this.proxy(this,this.connect)):(this.connect(),this.addConnectionListeners())}},{key:"connect",value:function(){var e=this;(this.port=this.port||browser.runtime.connect({name:this.name})).onDisconnect.addListener(function(){return e.port=null})}},{key:"addConnectionListeners",value:function(e){var t=this;browser.runtime.onConnect.addListener(function(n){n.onMessage.addListener(t.proxy(t,t.passMessage)),!e||e()})}}]),t}()},30:function(e,t,n){"use strict";n(89);var r=n(0),o=(i(r),i(n(29)),i(n(16)));function i(e){return e&&e.__esModule?e:{default:e}}n(28),n(27),n(26),n(25),(0,r._L10N)(),new r._MODULE({events:{ENV:{"started:app":"onStart","toggled:addon":"power"}},power:function(e){var t=document.getElementById("textmarker-sidebar--paused"),n=document.getElementById("textmarker-sidebar");e?(t.classList.add("none"),n.classList.remove("none")):(t.classList.remove("none"),n.classList.add("none"))},onStart:function(){var e=this;o.default.get("mode").then(function(t){return e.power(t)})}})},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var o={},i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"on",value:function(e,t){o[e]||(o[e]=[]),o[e].push(t)}},{key:"emit",value:function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0,s=(e=e.split(" ")).length,u=void 0;a<s;a++)(u=o[e[a]])&&u.forEach(function(e){return e.apply(t,r)})}},{key:"request",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return browser.runtime.sendMessage({ev:e,args:n,wait:!0}).catch(function(){})}},{key:"proxy",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return function(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return t.apply(e,r.concat(o))}}}]),e}();t.default=i},5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n in t)e[n]||(e[n]=t[n]);return e}},6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t._COPY=function e(t,n){for(var o in n=n||{},t)t.hasOwnProperty(o)&&("object"===r(t[o])?(n[o]=Array.isArray(t[o])?[]:{},e(t[o],n[o])):n[o]=t[o]);return n}},89:function(e,t){},9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){document.addEventListener("DOMContentLoaded",function(){
/*
* Translates a HTMl page in the web l10n style from the Add-on SDK with WebExtensions strings.
* Modified by underflyingbirches
*
* @author Martin Giger
* @see {@link https://gist.github.com/freaktechnik/4a72bc0711d9bc82cf3b075bcc292953}
* @license MPL-2.0
*/
return function(){var e=void 0,t=void 0,n=void 0;document.documentElement.setAttribute("lang",browser.i18n.getUILanguage().replace("_","-"));var r=document.querySelectorAll("*[data-l10n-id]"),o=document.querySelectorAll("*[data-l10n-attr]"),i=!0,a=!1,s=void 0;try{for(var u,c=r[Symbol.iterator]();!(i=(u=c.next()).done);i=!0){e=u.value;var l=(n=e.dataset).l10nId;l&&(t=browser.i18n.getMessage(l))&&"??"!=t&&(e.textContent=t)}}catch(e){a=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw s}}var d=!0,f=!1,v=void 0;try{for(var p,b=o[Symbol.iterator]();!(d=(p=b.next()).done);d=!0)e=p.value,n=e.dataset,["Title","Placeholder"].forEach(function(r){var o=n["l10n"+r];o&&(t=browser.i18n.getMessage(o))&&"??"!=t&&e.setAttribute(r.toLowerCase(),t)})}catch(e){f=!0,v=e}finally{try{!d&&b.return&&b.return()}finally{if(f)throw v}}}()},{capture:!1,passive:!0,once:!0})}}});