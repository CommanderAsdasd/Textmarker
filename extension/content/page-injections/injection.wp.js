!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=42)}({0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._ERRORTRACKER=t._L10N=t._PORT=t._DOMMODULE=t._MODULE=t._EXTEND=t._GET_ACTIVE_TAB=t._COPY=void 0;var o=n(6),i=n(11),r=c(n(5)),s=n(1),a=n(10),u=n(3),d=c(n(9)),l=c(n(2));function c(e){return e&&e.__esModule?e:{default:e}}t._COPY=o._COPY,t._GET_ACTIVE_TAB=i._GET_ACTIVE_TAB,t._EXTEND=r.default,t._MODULE=s._MODULE,t._DOMMODULE=a._DOMMODULE,t._PORT=u._PORT,t._L10N=d.default,t._ERRORTRACKER=l.default},1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._MODULE=void 0;var o,i=n(4),r=(o=i)&&o.__esModule?o:{default:o};t._MODULE=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));for(r in e)n[r]=e[r];var o=n.events,i=void 0,r=void 0,s=void 0,a=void 0;if(o&&(i=o.ENV))for(s in i)n[a=i[s]]&&n.on(s,n.proxy(n,n[a]));return!n.autoinit||n.autoinit(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default),t}()},10:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._DOMMODULE=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(1);t._DOMMODULE=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e._bound={},e._extraBound=[];var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.addListenersManually||n.addListeners(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i._MODULE),o(t,[{key:"generalHandler",value:function(e,t,n){var o=n.target,i=void 0,r=void 0,s=void 0,a=void 0,u=void 0,d=void 0,l=void 0;for(i in e)if(r=i,d="."===(a=i[0]),l="*"===a,((u="#"===a)||d)&&(i=i.substr(1)),l||d&&o.classList.contains(i)||u&&o.id===i||o.nodeName.toLowerCase()===i){"function"==typeof(s=e[r])?s(n,o):this[s]&&this[s](n,o);break}}},{key:"addListener",value:function(e,t,n){n=n||this.el;var o="function"==typeof t?t:this[t];n.addEventListener(e,o,!1),n===this.el?(this._bound[e]||(this._bound[e]=[]),this._bound[e].push(o)):this._extraBound.push([n,e,o])}},{key:"addListeners",value:function(){var e=this.events,t=void 0,n=void 0,o=void 0,i=void 0,r=void 0;if(!e||!(t=e.DOM)||!(n=this.el))return!1;for(i in t)o=t[i],r=this.proxy(this,this.generalHandler,o,i),n.addEventListener(i,r,!1),this._bound[i]||(this._bound[i]=[]),this._bound[i].push(r)}},{key:"removeListeners",value:function(){var e=void 0,t=void 0,n=void 0;for(e in this._bound)for(n=(t=this._bound[e]).length;n--;)this.el.removeEventListener(e,t[n],!1),t.splice(n,1);var o=this._extraBound,i=0,r=void 0;for(n=o.length;i<n;i++)(r=o[i])[0].removeEventListener(r[1],r[2],!1)}}]),t}()},11:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t._GET_ACTIVE_TAB=function(){return browser.tabs.query({currentWindow:!0,active:!0}).then(function(e){return e[0]})}},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(7),s=(o=r)&&o.__esModule?o:{default:o};var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=this.self=window.getSelection();n.rangeCount&&(this.range=n.getRangeAt(0)),!t&&n.isCollapsed||(t?(this.defined=t,this.create(t).reduceToOneRange().update().collectNodes(!0).retrieveText()):(s.default.pdf&&this.adjust_PDF(),this.collectNodes().reduceToOneRange().update().adjust().update().retrieveText()),n.collapseToStart())}return i(e,[{key:"create",value:function(e){return this.self.selectAllChildren(e),this}},{key:"resume",value:function(e){var t=this.self;t.removeAllRanges(),t.addRange(e),this.reduceToOneRange().update().collectNodes().retrieveText(),t.collapseToStart()}},{key:"update",value:function(e){e?this.self=e:e=this.self;for(var t=["focusNode","anchorNode","focusOffset","anchorOffset"],n=t.length;n--;)this[t[n]]=e[t[n]];return this.range=e.getRangeAt(0),this.simple=this.isSimple(),this}},{key:"adjust",value:function(){this.self;var e=this.anchorNode,t=this.focusNode;return this.isBackwards(e,t)?this.reverse(e,t):this.normalize(e,t),this}},{key:"adjust_PDF",value:function(){for(var e=this.self,t=this.range.startContainer;t=t.parentNode;)if(t.id&&"viewer"===t.id)return this;try{t=window.document.getElementsByClassName("textLayer")[0].children[0].children[0]}finally{try{t=window.document.getElementsByClassName("textLayer")[0].children[0]}finally{t=window.document.getElementsByClassName("textLayer")[0]}}return e.getRangeAt(0).setStart(t,0),this}},{key:"normalize",value:function(e,t){this.self;var n=this.range,o=this.nodes[0],i=this.nodes[this.nodes.length-1];o!==e&&n.setStart(o,o.data.length-o.data.trimLeft().length),i!==t&&n.setEnd(i,i.data.length-(i.data.length-i.data.trimRight().length))}},{key:"collectNodes",value:function(e){for(var t,n=this,o=this.self,i=(this.range,e?window.document.body:this.getCommonAncestorContainer()),r=window.document.createNodeIterator(i,NodeFilter.SHOW_TEXT,{acceptNode:function(e){var t=e.parentNode;return o.containsNode(e)&&!n.isBlank(e)&&n.hasNormalParent(t)}},!1),s=(document.createRange(),[]);t=r.nextNode();)s.push(t);return this.nodes=this.getReducedNodeCollection(s),this.parentNodes=this.collectParentNodes(this.nodes),this}},{key:"getReducedNodeCollection",value:function(e){var t=this.self,n=void 0,o=void 0;return e.length>1&&(n=e[0],t.anchorNode===n&&n.data.trimRight().length<=t.anchorOffset&&e.shift(),o=e[e.length-1],t.focusNode===o&&this.isBlank(o.data.substr(0,t.focusOffset))&&e.pop()),e}},{key:"collectParentNodes",value:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n.push(e[o].parentNode);return n}},{key:"retrieveText",value:function(){for(var e=this.range,t=this.nodes,n=t.length,o=0,i=[];o<n;o++)i.push(t[o].data);return n-=1,i.length&&(this.simple?i[0]=i[0].substring(e.startOffset,e.endOffset):(i[0]=i[0].substring(e.startOffset),i[n]=i[n].substring(0,this.defined?void 0:e.endOffset)),this.text=i.join("")),this}},{key:"getCommonAncestorContainer",value:function(){for(var e=this.self,t=e.anchorNode,n=e.focusNode;t=t.parentNode;)if(16==(16&t.compareDocumentPosition(n)))return t;return window.document.body}},{key:"reverse",value:function(e,t){var n=window.document.createRange(),o=this.self;n.setStart(t,o.focusOffset),n.setEnd(e,o.anchorOffset),o.removeAllRanges(),o.addRange(n),this.update(o).adjust(o.anchorNode,o.focusNode)}},{key:"reduceToOneRange",value:function(){var e,t=this.self,n=t.rangeCount,o=this.range;return n<2?this:(e=t.getRangeAt(n-1),o.setStart(o.startContainer,o.startOffset),o.setEnd(e.endContainer,e.endOffset),t.removeAllRanges(),t.addRange(o),this)}},{key:"hasNormalParent",value:function(e){var t=e.tagName.toUpperCase();return"SCRIPT"!==t&&"STYLE"!==t&&"LINK"!==t&&"META"!==t&&"BASE"!==t&&"TITLE"!==t&&"NOSCRIPT"!==t&&"IMG"!==t&&"IFRAME"!==t&&"EMBED"!==t&&"PARAM"!==t&&"VIDEO"!==t&&"AUDIO"!==t&&"SOURCE"!==t&&"TRACK"!==t&&"CANVAS"!==t&&"MAP"!==t&&"AREA"!==t&&"MATH"!==t&&"OBJECT"!==t&&!this.isInsideSVG(e)}},{key:"isInsideSVG",value:function(e){for(;e;){if("svg"===e.nodeName)return!0;e=e.parentNode}return!1}},{key:"isBlank",value:function(e){return-1===("string"==typeof e?e:e&&"string"==typeof e.data?e.data:this.text).search(/[^\s\n\r\t]/g)}},{key:"isBackwards",value:function(e,t){var n=this.self,o=e.compareDocumentPosition(t);return 2===o||10===o||!o&&n.anchorOffset>n.focusOffset}},{key:"isSimple",value:function(){var e=this.self,t=e.anchorNode,n=e.focusNode;return t===n&&3===t.nodeType&&(!t.nextSibling||4!==t.nextSibling.compareDocumentPosition(n))}}]),e}();t.default=a},2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=new(n(1)._MODULE)({autoinit:function(){var e=this;window.addEventListener("error",function(t){var n=t.filename.split("/").pop();["sidebar.wp.js","tbb-menu.wp.js","options.wp.js","addon-page.wp.js"].includes(n)&&e.emit("error:browser-console",{message:t.message,location:t.filename.split("/").pop().split(".").shift()+":"+t.lineno+":"+t.colno,time:(new Date).getTime()})},!1)}});t.default=o},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._PORT=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(1);t._PORT=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));n.port=null;var o=n.type;browser.runtime.onMessage.addListener(n.proxy(n,n.passMessage)),"privileged"!==o&&"background"!==o||n.initPorting();var i=n.events,r=void 0,s=void 0;if(i){if(r=i.ONEOFF){var a=!0,u=!1,d=void 0;try{for(var l,c=r[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var h=l.value;n.on(h,n.proxy(n,n.sendMessage,h))}}catch(e){u=!0,d=e}finally{try{!a&&c.return&&c.return()}finally{if(u)throw d}}}if(s=i.CONNECTION){var f=!0,p=!1,v=void 0;try{for(var m,g=s[Symbol.iterator]();!(f=(m=g.next()).done);f=!0){var y=m.value;n.on(y,n.proxy(n,n.postMessage,y))}}catch(e){p=!0,v=e}finally{try{!f&&g.return&&g.return()}finally{if(p)throw v}}}}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i._MODULE),o(t,[{key:"passMessage",value:function(e,t,n){e.args=e.args||[];var o=[].concat(e.ev,e.args);return t&&t.name||(o=o.concat(t,n)),this.emit.apply(this,o),!!e.wait}},{key:"sendMessage",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i=this.type,r={ev:e,args:n};if("content"===i)browser.runtime.sendMessage(r).catch(function(){});else if("background"===i){var s=n[n.length-1];void 0!==s&&s.tab?browser.tabs.sendMessage(s.tab,r).catch(function(){}):browser.tabs.query({}).then(function(e){var t=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var a=i.value;browser.tabs.sendMessage(a.id,r).catch(function(){})}}catch(e){n=!0,o=e}finally{try{!t&&s.return&&s.return()}finally{if(n)throw o}}})}}},{key:"postMessage",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];var i={ev:e,args:n};this.port&&this.port.postMessage(i)}},{key:"initPorting",value:function(){this.postponeConnection?this.addConnectionListeners(this.proxy(this,this.connect)):(this.connect(),this.addConnectionListeners())}},{key:"connect",value:function(){var e=this;(this.port=this.port||browser.runtime.connect({name:this.name})).onDisconnect.addListener(function(){return e.port=null})}},{key:"addConnectionListeners",value:function(e){var t=this;browser.runtime.onConnect.addListener(function(n){n.onMessage.addListener(t.proxy(t,t.passMessage)),!e||e()})}}]),t}()},31:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=window.document;return new i._DOMMODULE({events:{ENV:{"updated:misc-settings":"updatePosition","added:note":"onNoteAdded","added:bookmark":"onBookmarkAdded","removed:last-note":"onLastNoteRemoved","removed:bookmark":"onBookmarkRemoved"},DOM:{click:{tmnotestoggle:"toggleNotes",tmbm:"scrollToBookmark"}}},addListenersManually:!0,el:null,notesBtn:null,bmBtn:null,notesBtnActive:!1,bmBtnActive:!1,bookmark:!1,notes:!1,autoinit:function(){this.createEl(),this.createBtns(),this.addListeners()},createEl:function(){var e=this.el=t.createElement("tmui");t.body.appendChild(e),this.updatePosition()},createBtns:function(){var e=this.notesBtn=t.createElement("tmnotestoggle"),n=this.bmBtn=t.createElement("tmbm");e.title=browser.i18n.getMessage("toggle_notes"),n.title=browser.i18n.getMessage("bm_scroll"),s.default.pdf&&(bm.className="textmarker-bookmark-control")},addBtn:function(e){this.el.appendChild(e),this.el.classList.add("active")},removeBtn:function(e){this.el.removeChild(e),this.el.children.length||this.el.classList.remove("active")},updatePosition:function(){var e=this;s.default.get("tmuipos").then(function(t){return e.el.setAttribute("style",t.split("-").map(function(e){return e+":1px;"}).join(" "))})},onNoteAdded:function(){var e=this;this.notes=!0,this.notesBtnActive||s.default.get("noteicon").then(function(t){t&&(e.addBtn(e.notesBtn),e.notesBtnActive=!0)})},onLastNoteRemoved:function(){this.notes=!1,this.notesBtnActive&&(this.removeBtn(this.notesBtn),this.notesBtnActive=!1)},onBookmarkAdded:function(){var e=this;this.bookmark=!0,this.bmBtnActive||s.default.get("bmicon").then(function(t){t&&(e.addBtn(e.bmBtn),e.bmBtnActive=!0)})},onBookmarkRemoved:function(){this.bookmark=!1,this.bmBtnActive&&(this.removeBtn(this.bmBtn),this.bmBtnActive=!1)},toggleNotes:function(){this.emit("toggle:notes")},scrollToBookmark:function(){this.emit("scroll-to-bookmark")}})};var o,i=n(0),r=n(7),s=(o=r)&&o.__esModule?o:{default:o}},32:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=window.document.body;return new i._DOMMODULE({events:{DOM:{click:{tmnotedelete:"_delete",tmnoteminimize:"hide",textarea:"bringUpFront"},keyup:{textarea:"attemptUpdate"}}},addListenersManually:!0,el:null,mark:e,markClickHandler:null,text:"",visible:!1,recentlyUpdated:!1,autoinit:function(){this.createNoteElement(),this.addListeners(),this.addMarkListeners()},createNoteElement:function(){var e=this,t=this.el=document.createElement("tmnote"),n=this.del=document.createElement("tmnotedelete"),o=this.min=document.createElement("tmnoteminimize"),i=this.textElement=document.createElement("textarea"),r=this.mark.keyData.note||"",s=document.createTextNode(String.fromCharCode(10005)),a=document.createTextNode(String.fromCharCode(8211));i.setAttribute("data-tm-note",!0),n.appendChild(s),o.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(i),r&&(i.value=r),i.addEventListener("blur",function(t){return e.attemptUpdate(t,t.target,!0)},!1)},_delete:function(){this.remove(),this.mark.keyData.note=""},remove:function(){this.hide(),this.removeMarkListeners(),this.emit("removed:note",this.mark.id)},attemptUpdate:function(e,t,n){var o=this;n?this.update(t):this.recentlyUpdated||(this.recentlyUpdated=!0,window.setTimeout(function(){return o.update(t)},3e3))},update:function(e){this.mark.keyData.note=e.value,this.emit("updated:note"),this.recentlyUpdated=!1},show:function(){var e=this.el,n=this.getPosition(),o=window.innerWidth,i=n.left;i+340>o&&(i=o-340),t.appendChild(e),e.setAttribute("style","display:block;top:"+(n.top+n.offset)+"px;left:"+i+"px;"),this.visible=!0},bringUpFront:function(){var e=this;Array.from(t.getElementsByTagName("tmnote")).forEach(function(t){t===e.el?t.style.zIndex=2147483647:t.style.zIndex=2147483646})},hide:function(){t.removeChild(this.el),this.visible=!1},addMarkListeners:function(){var e=this;s.default.get("noteonclick").then(function(t){if(t){var n=e.markClickHandler=function(){return e.show()},o=!0,i=!1,r=void 0;try{for(var s,a=e.mark.wrappers[Symbol.iterator]();!(o=(s=a.next()).done);o=!0){var u=s.value;u.addEventListener("click",n,!1),u.setAttribute("title",browser.i18n.getMessage("toggle_note"))}}catch(e){i=!0,r=e}finally{try{!o&&a.return&&a.return()}finally{if(i)throw r}}}})},removeMarkListeners:function(){if(this.markClickHandler){var e=!0,t=!1,n=void 0;try{for(var o,i=this.mark.wrappers[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var r=o.value;r.removeEventListener("click",this.markClickHandler,!1),r.removeAttribute("title")}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},getPosition:function(){var e=this.mark.wrappers[this.mark.wrappers.length-1].getBoundingClientRect();return{top:e.top+window.pageYOffset-t.clientTop,left:e.left+window.pageXOffset-t.clientLeft,offset:e.height}}})};var o,i=n(0),r=n(7),s=(o=r)&&o.__esModule?o:{default:o}},33:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=window.document;return new o._MODULE({events:{ENV:{"add:note":"addAndShow","removed:note":"removeNoteStorage","restore:notes":"restore","removed:mark":"removeNote","toggle:notes":"toggleAll","sidebar:toggle-notes":"toggleAll"}},notes:{},toggle:null,add:function(e){return this.notes[e.id]=new i.default(e)},restore:function(e){var t=!0,n=!1,o=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var s=i.value;s.keyData.note&&(this.add(s),this.emit("added:note"))}}catch(e){n=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw o}}},addAndShow:function(e){this.add(e).show(),this.emit("added:note")},removeNoteStorage:function(e){delete this.notes[e],this.isEmpty(this.notes)&&this.emit("removed:last-note")},removeNote:function(e){this.notes[e]&&this.notes[e].remove()},toggleAll:function(){if(this.notes){var t=this.notes,n=e.getElementsByTagName("tmnote").length?"hide":"show",o="hide"===n,i=void 0;for(var r in t)(i=t[r]).visible===o&&i[n]()}},isEmpty:function(e){return!Object.keys(e).length}})};var o=n(0),i=(r(n(7)),r(n(32)));function r(e){return e&&e.__esModule?e:{default:e}}},34:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.default=function(){return[new u({events:{ENV:{"restore:marks":"init"}},queue:[],cache:[],lost:[],restored:[],area:"sync",phase:1,init:function(e){if(r.default.pdf)return!1;r.default.name=e.name,r.default.entry=e;var t=[],n=[],o=e.marks,i=o.length,s=0,a=void 0;for(this.area=e.synced?"sync":"local";s<i;s++)a=o[s],this.convertDescription(a).createTempObject(a),"TM"===a.conds.n1?n.push(a):t.push(a);for(this.queue.push(t),s=0,i=n.length;s<i;s++)this.queue.push([n[s]]);this.restore().report()},convertDescription:function(e){if(void 0===e.conds.o){var t=e.conds,n={o:t.startOffset,n1:t.firstNodeName,n2:t.firstParentNodeName,p1:t.firstTextNodePosition,p2:t.firstNodePosition,p3:t.firstParentNodePosition,p4:t.firstGrampaNodePosition};delete e.conds,e.conds=n}return this},createTempObject:function(e){var t=this.squeeze(e.text);e.temp={trimmedText:t,trimmedTextLength:t.length,possiblePositions:[],possibleStartNodes:[],possibleEnds:{},possibleFocusOffsets:[]}},restore:function(){2===this.phase&&this.sortQueueById();var e=this.marks=this.queue.shift(),t=e?e.length:0;return this.length=t,t&&(this.setBodySelection(window.document.body).getTextPositions(e,t),1===this.phase&&t>1&&this.postponeOverlappings(),this.findPossibleExtrema().ruleOutMultiples().recreateMarks()),this.phase++,this.queue.length&&this.restore(),this},sortQueueById:function(){for(var e,t=this.queue,n=t?t.length:0,o=[],i=0,r=void 0;n--;)t[n].length&&(o[(r=t[n][0]).id]=r);for(this.queue=[],e=o.length;i<e;i++)o[i]&&this.queue.push([o[i]]);return this},getTextPositions:function(e,t){for(var n=this.trimmedSelectionText,o=this.allPossibleStartPositions=[],i=[],r=void 0,s=void 0,a=void 0,u=void 0,d=void 0,l=void 0;t--;)if(d=void 0,s=(r=e[t]).temp){for(a=s.trimmedText,u=s.trimmedTextLength;-1!==d;)void 0===d&&(d=-1),l=(d=n.indexOf(a,d+1))+u,s.possiblePositions.push(d),o.push([d,l,r]),i.push(l);s.possiblePositions.pop(),o.pop(),i.pop(),s.possiblePositions.length||this.lost.push(r)}else e.splice(t,1);return this.sortPossibleStartPositions(o),this.maxPosition=Math.max.apply(null,i),this},sortPossibleStartPositions:function(e){for(var t,n=e.length,o=[],i=0,r=void 0,s=void 0;n--;)o[s=(r=e[n])[0]]?o.splice(s+1,0,r):o[s]=r;for(t=o.length,this.allPossibleStartPositions=[];i<t;i++)o[i]&&this.allPossibleStartPositions.push(o[i])},postponeOverlappings:function(){var e=this.allPossibleStartPositions,t=e.length,n=[],o=void 0,i=void 0,r=void 0,s=void 0,a=void 0,u=void 0;if(t>1){for(;t-- >1;)o=e[t-1],i=e[t],o[1]>i[0]&&o[0]<i[1]&&(s=o[2],a=i[2],s.id<a.id?(u=a.id,n.includes(u)||(this.postpone(a),n.push(u))):(u=s.id,n.includes(u)||(this.postpone(s),n.push(u))));for(t=n.length,r=0;r<t;r++)this.cutOutFor(n[r])}return this},cutOutFor:function(e){for(var t=this.allPossibleStartPositions,n=t.length;n--;)t[n][2].id===e&&this.allPossibleStartPositions.splice(n,1)},postpone:function(e){for(var t=this.queue,n=t.length,o=!1;n--;)if(t[n][0]===e){o=!0;break}o||this.queue.push([e])},findPossibleExtrema:function(){this.selection,this.range;for(var e=this.bodyTextNodes,t=e.length,n=this.allPossibleStartPositions,o=this.phase,i=this.cache=[],r=[],s=0,a=0,u=void 0,d=void 0,l=void 0,c=void 0,h=void 0,f=void 0,p=void 0,v=void 0,m=void 0,g=void 0,y=void 0,b=void 0,k=void 0,w=void 0;s<t;s++){for(u=e[s],a+=d=this.squeeze(u.data).length,c=n.length,b=[],k=[],w=null;c--;){if(h=n[c][0],f=n[c][1],p=(l=n[c][2]).id,l.temp.startFoundFor=l.temp.startFoundFor||[],l.temp.endFoundFor=l.temp.endFoundFor||[],!l.temp.startFoundFor.includes(h)&&a>h&&l.temp.possibleStartNodes.length<l.temp.possiblePositions.length){if(w&&w.id<l.id){1===o&&(this.postpone(l),k.push(p)),n.splice(c,1);continue}if(!this.satisfiesDescription(l,u)){1===o&&1!==p&&(this.postpone(l),k.push(p)),n.splice(c,1);continue}l.temp.possibleStartNodes.push(u),l.temp.startFoundFor.push(h),b.push(p)}l.temp.startFoundFor.includes(h)&&!l.temp.endFoundFor.includes(f)&&a-f>=0&&(Math.min.apply(null,b)<p?(1===o&&(this.postpone(l),k.push(p)),n.splice(c,1)):(y=this.findFocusOffset(l,u,f-(a-d)),l.temp.possibleFocusOffsets.push(y),l.temp.endFoundFor.push(f),l.temp.possibleEnds[h]={node:u,offset:y},r.includes(p)||(i.push(l),r.push(p)),w=l,n.splice(c,1)))}if(v=k.length)for(m=0;m<v;m++)this.cutOutFor(k[m]);if(a>this.maxPosition)break}if(1!==o)for(g in this.marks)r.includes(this.marks[g].id)||this.lost.push(l);return this},ruleOutMultiples:function(){for(var e=this.cache,t=e.length,n=void 0,o=void 0,i=void 0,r=void 0,s=void 0,a=void 0,u=void 0,d=void 0;t--;){if(u=[],!1,(i=(o=(n=e[t]).temp.possibleStartNodes).length)>1){for(;i--;)(s=(r=o[i].parentNode.parentNode).parentNode||0)&&n.conds.p3!==this.whichChild(s,r)||u.push(i);if(u.length)if(1===u.length)i=u[0];else{for(i=void 0;u.length;)if(!(a=(s=(r=o[d=u.pop()].parentNode).parentNode||0)&&s.parentNode?s.parentNode:0)||n.conds.p4===this.whichChild(a,s)){i=d;break}i||(i=0)}else i=0}else i=0;i=i||0,n.temp.startNode=n.temp.possibleStartNodes[i],this.setMatchingEnd(n,i)}return this},setMatchingEnd:function(e,t){var n=e.temp.startFoundFor[t],o=e.temp.possibleEnds[n];e.temp.endNode=o.node,e.temp.focusOffset=o.offset},satisfiesDescription:function(e,t){var n=e.conds,o=t.parentNode,i=o.parentNode,r=(i&&i.parentNode&&i.parentNode,n.o),s=t.data.substring(r).trim(),a=s.length,u=e.text.trim();return(u.length<=a?0===this.squeeze(s).indexOf(this.squeeze(u)):0===this.squeeze(u).indexOf(this.squeeze(s)))&&(o.nodeName===n.n1||"TM"===n.n1&&o.hasAttribute("data-tm-id"))&&(!i||i.nodeName===n.n2)&&this.whichChild(o,t)===n.p1},findFocusOffset:function(e,t,n){for(var o=t.data,i=o.length,r=0,s=0;r<i;r++)if(this.squeeze(o[r])&&s++,s===n)return/\s$/.test(e.text)?r+2:r+1},recreateMarks:function(){for(var e=this.range,t=this.selection,n=this.cache,o=n.length,i=void 0,r=void 0,s=void 0,a=void 0,u=void 0;o--;)if(s=(r=(i=n[o]).temp).startNode,a=r.endNode,u=r.focusOffset,s&&a&&"number"==typeof u){try{e.setStart(s,i.conds.o),e.setEnd(a,u),t.resume(e),this.emit("restored:range",t,i),this.restored.push(i)}catch(e){this.lost.push(i)}delete i.temp}else this.lost.push(i)}}),new u({events:{ENV:{"restore:marks":"init"}},sel:null,trimmedText:"",lost:[],restored:[],init:function(e){if(!r.default.pdf)return!1;r.default.name=e.name,r.default.entry=e,this.area=e.synced?"sync":"local",this.restore(e.marks,e.count)},restore:function(e,t){var n=e.length,o=this,i=(this.selection,window.document.getElementsByClassName("page")),r={},s=[],a=void 0,u=void 0,d=void 0,l=void 0,c=void 0,h=void 0,f=void 0;for(f=0;f<n;f++)if(c=(l=(d=e[f]).conds).pages[0],s.push(c),r[c]=r[c]||[],r[c].push(d),l.pageIntersection){h=l.pages[1];do{r[h]=r[h]||[],r[h].push(d),s.push(h)}while(--h>c)}function p(e){var t=e.text,n=void 0,i=void 0;if(o.setBodySelection(u),n=o.selection,i=o.range,!o.textExistsOnPage(u,t))return delete e.conds,o.lost.push(e),!0;var r=e.conds,s=r.containers[0],d=r.containers[1],l=void 0===d?[s,s]:[s,d],c=r.offsets,h=void 0,f=void 0,p=void 0;r.pageIntersection&&(r.pages[0]===a?(l[1]=-1,c[1]=-1):(l[0]=0,c[0]=0)),l.forEach(function(e,t){"string"==typeof e?l[t]=u.querySelector('span[data-tm-id="'+e+'"]'):(h=h||u.getElementsByClassName("textLayer")[0].querySelectorAll("div"),f=f||h.length,e<0?(p=l[1]=h[f-1],c[1]=p.lastChild.data.length):l[t]=h[e])}),l[1]=l[1]||l[0];try{i.setStart(l[0].childNodes[r.nodes[0]],c[0]),i.setEnd(l[1].childNodes[r.nodes[1]],c[1]),n.resume(i),o.emit("restored:range",n,e),o.restored.push(e)}catch(t){delete e.conds,o.lost.push(e)}return!0}s=function(e){for(var t=e.length,n=[],o=0;o<t;o++)o!==t-1&&e[o]===e[o+1]||n.push(e[o]);return n}(s.sort(function(e,t){return e-t}));var v=window.setInterval(function(){var e=s.length,t=void 0,n=void 0,d=void 0,l=void 0;if(i=window.document.getElementsByClassName("page"),!e)return window.clearInterval(v),!1;for(;e--;)t=s[e]-1,(n=i[t])&&n.hasAttribute("data-loaded")&&(d=n.querySelectorAll(".textLayer div"))&&(l=d.length)&&d[l-2].firstChild&&d[l-2].firstChild.data.length&&(a=s.splice(e,1)[0],u=n,o.processPeuAPeu(r[a],p,o.proxy(o,o.report)))},100)},textExistsOnPage:function(e,t){var n=this.trimmedSelectionText;return t=this.trimmedText=this.squeeze(t),-1!==n.indexOf(t)}})]};var i=n(0),r=a(n(7)),s=a(n(17));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i._MODULE),o(t,[{key:"processPeuAPeu",value:function(e,t,n){var o=Array.prototype.slice.call(e);!function e(){var i=+new Date+500;do{t(o[0])&&o.shift()}while(o.length>0&&i>+new Date);o.length>0?window.setTimeout(function(){return e()},25):n()}()}},{key:"setBodySelection",value:function(e){var t=this.selection=new s.default(e);return this.trimmedSelectionText=this.squeeze(t.text),this.bodyTextNodes=t.nodes,this.range=t.range,this}},{key:"squeeze",value:function(e){return e.replace(/\t|\s|\n|\r/g,"")}},{key:"whichChild",value:function(e,t,n){if(!e||!t)return null;for(var o=3===t.nodeType?e.childNodes:e.children,i=o.length,r=0,s=0,a=void 0;s<i;s++){if((a=o[s])===t)return r;n?a.nodeName===n&&r++:(3!==a.nodeType||a.data)&&r++}}},{key:"report",value:function(){var e=this.lost.length;if(e){for(;e--;)delete this.lost[e].temp;this.emit("failed:restoration")}else this.emit("succeeded:restoration");this.emit("finished:restoration",r.default.name,this.restored,this.lost,this.area)}}]),t}()},35:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(7);(o=r)&&o.__esModule;var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mark=null,this.anchor=null}return i(e,[{key:"set",value:function(e){var t=(e=e||this.mark).wrappers,n=t.length,o=t[0];for(e.keyData.bookmark=!0,o.id="textmarker-bookmark-anchor";n--;)t[n].classList.add("textmarker-bookmark");return this.mark=e,this.anchor=o,this}},{key:"remove",value:function(){var e=this.mark,t=this.anchor,n=e.wrappers,o=n.length;for(t.id="",e.keyData.bookmark=!1;o--;)n[o].classList.remove("textmarker-bookmark")}},{key:"scrollIntoView",value:function(e){(e||(e=window.document.getElementById("textmarker-bookmark-anchor")))&&e.scrollIntoView()}}]),e}();t.default=s},36:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(7),s=(o=r)&&o.__esModule?o:{default:o};var a=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i,r;for(var s in this.marker=t,r={style:"",bookmark:!1,conds:null,text:(i=this.selection=t.selection).text,note:""})o.hasOwnProperty(s)||(o[s]=r[s]);o.id=o.id||++t.idcount,this.id=o.id,this.simple=i.simple;var a=this.range=i.range;this.startOffset=a.startOffset,this.endOffset=a.endOffset,this.wrappers=null,this.containers=[],this.anchorNodePosition=null,this.focusNodePosition=null,this.keyData={id:o.id,key:n,style:o.style,conds:o.conds,text:o.text,bookmark:o.bookmark,note:o.note}}return i(e,[{key:"create",value:function(e){e=e||this.range;for(var t=this.selection,n=this.keyData.style,o=t.nodes,i=o.length,r=this.wrappers=this.wrappers||this.createWrappers(n,i),s=0,a=i-1,u=void 0;s<i;s++)u=o[s],e.selectNodeContents(u),s||e.setStart(u,this.startOffset),s===a&&e.setEnd(u,this.endOffset),e.surroundContents(r[s]),this.containers.push(r[s].parentNode),u.parentNode.normalize();return this.definePosition(a),this.keyData.bookmark&&this.marker.setBookmark(this,!1),this.keyData.conds||this.describe(),this.registerClickListeners(),this}},{key:"registerClickListeners",value:function(){var e=this,t=this.wrappers,n=!0,o=!1,i=void 0;try{for(var r,a=t[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){r.value.addEventListener("click",function(t){s.default.tmid=t.target.getAttribute("data-tm-id"),e.marker.emit("clicked:mark",{bookmark:!!e.keyData.bookmark,note:!!e.keyData.note})},!1)}}catch(e){o=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw i}}}},{key:"definePosition",value:function(e,t){var n=this.wrappers;e="number"==typeof e?e:n.length-1;var o=n[0],i=n[e];return this.anchorNodePosition=this.whichChild(o.parentNode,o,!0)-1,this.focusNodePosition=this.whichChild(i.parentNode,i,!0),i.previousSibling&&3!==i.previousSibling.nodeType||(this.focusNodePosition-=1),this.anchorNodePosition<0&&(this.anchorNodePosition=0),this.focusNodePosition<0&&(this.focusNodePosition=0),t&&(this.startOffset=o.previousSibling&&o.previousSibling.data?o.previousSibling.data.length:0,this.endOffset=this.simple?this.startOffset+this.keyData.text.length:this.endOffset),this}},{key:"resume",value:function(){return this.definePosition(void 0,!0).describe(),this}},{key:"undo",value:function(){for(var e=this.containers,t=this.wrappers,n=t.length,o=void 0,i=void 0;n--;)o=e[n],i=t[n],o.replaceChild(i.firstChild,i),o.normalize();return this}},{key:"redo",value:function(){var e=this.containers,t=this.selection.self,n=this.range;return n.setStart(e[0].childNodes[this.anchorNodePosition],this.startOffset),n.setEnd(e[e.length-1].childNodes[this.focusNodePosition],this.endOffset),t.removeAllRanges(),t.addRange(n),this.selection.collectNodes(),t.collapseToStart(),this.create()}},{key:"whichChild",value:function(e,t,n){if(!e||!t)return null;for(var o=n||3===t.nodeType?e.childNodes:e.children,i=o.length,r=0;r<i;r++)if(o[r]===t)return r}},{key:"createWrappers",value:function(e,t){for(var n=[],o=this.keyData.note,i=0,r=void 0;i<t;i++)(r=window.document.createElement("span")).classList.add("textmarker-highlight"),r.setAttribute("style",e),r.setAttribute("data-tm-id",this.id+"_"+i),o&&r.setAttribute("title",browser.i18n.getMessage("toggle_note")),n.push(r);return n}},{key:"describe",value:function(){if(s.default.pdf)return this._describe_PDF();this._describe()}},{key:"_describe",value:function(){var e=this.range,t=(this.selection,e.startContainer,e.endContainer,this.simple,this.wrappers[0].parentNode),n=t.hasAttribute("data-tm-id"),o=t.parentNode,i=o.parentNode||0,r=this.anchorNodePosition;return this.keyData.conds={o:this.startOffset,n1:n?"TM":t.nodeName,p1:r,n2:o.nodeName,p2:this.whichChild(o,t),p3:i?this.whichChild(i,o):void 0,p4:i&&i.parentNode?this.whichChild(i.parentNode,i):void 0},this.keyData.conds}},{key:"_describe_PDF",value:function(){var e=this,t=(this.range,this.wrappers[0]),n=this.wrappers[this.wrappers.length-1],o=this.simple,i=o?[t]:[t,n],r=this.startOffset,s=this.endOffset,a=[this.anchorNodePosition,this.focusNodePosition],u=[r,s],d=[],l=[],c=void 0,h=void 0;return i.forEach(function(t,n){for((c=t.parentNode).hasAttribute("data-tm-id")?d[n]=c.getAttribute("data-tm-id"):(c=c.parentNode,t=t.parentNode,d[n]=e.whichChild(c,t,"DIV"));void 0===l[n]&&c.parentNode;)(h=c.className)&&"page"===h?l[n]=1*c.getAttribute("data-page-number"):c=c.parentNode;void 0===l[n]&&(l[n]=d[n]=u[n]=-1*n),void 0===d[n]&&(d[n]=-1*n),l[n]=l[n]||1}),this.keyData.conds={pageIntersection:!o&&l[0]!==l[1],offsets:u,containers:d,nodes:a,pages:l},this.keyData.conds}}]),e}();t.default=a},37:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return new o._MODULE({events:{ENV:{"set:entry":"updateID","unset:entry":"resetID","pressed:marker-key":"onMarkerKey","pressed:hotkey":"onHotkey","restored:range":"recreate","finished:restoration":"onFinishedRestoration","ctx:b":"setBookmark","ctx:-b":"removeBookmark","ctx:d":"remove","ctx:m":"onMarkerKey","ctx:n":"addNote","updated:note":"autosave","removed:note":"autosave","sidebar:highlight":"onMarkerKey","sidebar:delete-highlight":"remove","sidebar:bookmark":"setBookmark","sidebar:delete-bookmark":"removeBookmark","sidebar:note":"addNote","sidebar:save-changes":"save","sidebar:undo":"undo","sidebar:redo":"redo","sidebar:scroll-to-bookmark":"scrollToBookmark","scroll-to-bookmark":"scrollToBookmark"}},selection:null,done:[],undone:[],bookmark:null,removedBookmark:null,idcount:0,updateID:function(){var e=i.default.entry;if(e.idcount)this.idcount=e.idcount;else{var t=(e.marks||[]).concat(e.lost||[]),n=t.length,o=[];if(n){for(;n--;)o.push(t[n].id);this.idcount=Math.max.apply(null,o)}}},resetID:function(){this.idcount=0},mark:function(e,t){return this.undone.length=0,new r.default(this,e,t).create()},undo:function(e){if(this.done.length){var t=this.done.pop(),n=t.id;this.undone.push(t.undo()),this.bookmark&&this.undoBookmark(),this.emit("removed:mark",n)}e||this.autosave()},redo:function(e){if(this.undone.length){var t=this.undone.pop();this.done.push(t.redo()),this.emit("restore:notes",[t])}e||this.autosave()},cutOut:function(e){var t,n=this,o=this.done,i=o.length,r=[e],s=[e],a=void 0;function u(e){for(var t=e+1;t<i;t++)a=o[t],n.marksIntersect(o[e],a)&&(r.includes(t)||r.push(t),s.push(t));s.sort(),r.sort()}for(;s.length;)u(s.shift());for(t=Math.min.apply(null,r);r.length;)this.done.splice(r.pop(),1)[0].undo(),this.undone.pop();return t},remove:function(e){if(!(e=e||(i.default.tmid?i.default.tmid:"")))return this.undo();var t=this.getById(e.split("_")[0]),n=this.done,o=n.length,r=n.indexOf(t),s=void 0,a=void 0;if(r===o-1)this.undo(),this.undone.pop();else if(this.undone.length){for(a=this.undone.length;this.undone.length;)this.redo(!0);for(s=this.cutOut(r),this.done.forEach(function(e){e.id>s&&e.resume()});a--;)this.undo(!0);this.autosave()}else s=this.cutOut(r),this.done.forEach(function(e){e.id>s&&e.resume()}),this.autosave();this.emit("removed:mark",e[0])},save:function(){var e=this,t=i.default.iframe;i.default.get("naming").then(function(n){if(i.default.isNew&&"custom"===n)e.request("name:entry?").then(function(n){if(n){var o=t?browser.i18n.getMessage("nm_message_iframe"):"";i.default.name=window.prompt(browser.i18n.getMessage("nm_message",o)),i.default.name&&e.retrieveEntry().then(function(t){return e.emit("save:entry?",t)})}});else if(i.default.isNew){var o=!0;t&&(o=window.confirm(browser.i18n.getMessage("nm_message_iframe"))),o&&e.retrieveEntry().then(function(t){return e.emit("save:entry?",t)})}else e.retrieveEntry().then(function(t){return e.emit("update:entry?",t)})})},autosave:function(){var e=this;i.default.get("autosave").then(function(t){t?e.save():e.emit("unsaved-changes")})},store:function(e,t,n){this.done.push(e),!1!==n&&this.autosave()},recreate:function(e,t){this.selection=e,this.store(this.mark(t.key,t),e.text,!1)},onFinishedRestoration:function(){this.emit("restore:notes",this.done),this.sortById(),this.scrollToBookmark()},addNote:function(e){this.emit("add:note",this.findMark(e))},setBookmark:function(e,t){var n=this.bookmark,o=this.findMark(e);if(!o)return!1;n&&(n.remove(),this.emit("removed:bookmark")),this.bookmark=(new s.default).set(o),this.emit("added:bookmark"),!1!==t&&this.autosave()},undoBookmark:function(){this.bookmark=null,this.emit("removed:bookmark")},removeBookmark:function(){var e=this.bookmark;if(!e)return!1;e.remove(),this.bookmark=null,this.removedBookmark=e,this.emit("removed:bookmark"),this.autosave()},scrollToBookmark:function(){var e=this.bookmark;e&&e.scrollIntoView()},getById:function(e,t){for(var n=this.done,o=n.length,i=void 0;o--;)if((i=n[o]).keyData.id==e)return t?{mark:i,position:o}:i;return!!t&&{mark:null,position:null}},findMark:function(e){return(e=e||(i.default.tmid?i.default.tmid:""))?"string"==typeof e?this.getById(e.split("_")[0]):e:this.done[this.done.length-1]},sortById:function(){this.done.sort(function(e,t){var n=e.id,o=t.id;return n===o?0:n<o?-1:1})},marksIntersect:function(e,t){for(var n=e.wrappers,o=n.length,i=(e.id,t.wrappers),r=t.id,s=void 0,a=void 0,u=void 0;o--;)for(s=i.length;s--;)for(u=(a=n[o].querySelectorAll("[data-tm-id]")).length;u--;)if(a[u].getAttribute("data-tm-id")[0]==r)return!0;return!1},onMarkerKey:function(e,t){var n=this;if(!(this.selection=new a.default).nodes)return!1;e?"string"==typeof e?t=e:this.preventDefault(e):t=t||"m",i.default.get("markers").then(function(e){n.store(n.mark(t,{style:e[t]}))})},onHotkey:function(e){switch(e){case"z":this.undo();break;case"y":this.redo();break;case"s":this.save();break;case"b":this.setBookmark()}},preventDefault:function(e){return e&&e.preventDefault&&(e.preventDefault(),e.stopPropagation()),this},retrieveEntry:function(){var e=this,t=i.default.entry||{};return this.collectMarks().then(function(n){return t.marks=n,t.last=(new Date).getTime(),t.bookmarked=!!e.bookmark,t.title=window.document.title,t.count=t.marks.length,t.idcount=e.idcount,i.default.isNew&&(t.name=i.default.name,t.first=t.last,t.url=window.document.URL,t.synced="sync"===i.default.area_history),t})},collectMarks:function(){var e=this;return i.default.get("history").then(function(t){for(var n=[],o=[],r=e.done,s=i.default.isNew?null:t.entries[i.default.name]?t.entries[i.default.name].marks:null,a=r.length,u=0,d=void 0;u<a;u++)d=r[u].keyData,n.push(d),o.push(d.id);if(i.default.pdf&&s)for(u=0,a=s.length;u<a;u++)-1===o.indexOf(s[u].id)&&n.push(s[u]);return n})}})};var o=n(0),i=u(n(7)),r=u(n(36)),s=u(n(35)),a=u(n(17));function u(e){return e&&e.__esModule?e:{default:e}}},38:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return new i._DOMMODULE({events:{ENV:{"toggled:addon":"activate"}},active:!1,autoinit:function(){this.activate(!0)},activate:function(e){e&&!this.active?(this.registerHandler(),this.active=!0):!e&&this.active&&(this.removeListeners(),this.active=!1)},registerHandler:function(){this.addListener("mousedown",function(e){2===e.button&&(e.target.classList.contains("textmarker-highlight")?s.default.tmid=e.target.getAttribute("data-tm-id"):s.default.tmid="")},window.document)}})};var o,i=n(0),r=n(7),s=(o=r)&&o.__esModule?o:{default:o}},39:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return new i._DOMMODULE({el:window.document,addListenersManually:!0,events:{ENV:{"started:app":"checkURL","toggled:addon":"power","deleted:entry":"unset","saved:entry":"update"},DOM:{keydown:{"*":"delegate"},selectionchange:{"*":"onSelectionChange"}}},url:"",active:!0,set:!1,initialized:!1,autoinit:function(){this.setup()},power:function(e){e?this.addListeners():this.removeListeners(),this.active=e,this.setup()},setup:function(){var e=this;s.default.get("mode").then(function(t){return e.active=t,!(e.set||!t)&&((s.default.pdf=e.isPdf())||"complete"===window.document.readyState?(s.default.iframe=e.isIFrame(),e.setURL(),e.checkURL(),e.removeListeners(),t&&e.addListeners(),void(e.set=!0)):e.addListener("load",function(){return e.setup()},window))})},setURL:function(){var e=window.document.URL,t=window.document.location.hash,n=e.indexOf(t)||e.length;this.url=e.substr(0,n)},isPdf:function(){return"pdf"===window.location.pathname.split(".").pop().substr(0,3)},isIFrame:function(){return window!==window.parent.window},isEditable:function(e){var t=e.tagName;return"TEXTAREA"===t||"INPUT"===t||"true"===e.contentEditable},delegate:function(e){var t=this,n=e.key.toLowerCase(),o=e.metaKey||e.ctrlKey||e.altKey||e.shiftKey,i=["m","2","3"];return!(["b","s","y","z"].includes(n)||!window.getSelection().isCollapsed)||(!!this.isEditable(e.target)||void s.default.get("settings").then(function(r){if(!r)return!0;if(o){var s=r.shortcuts[n];if(!s||!s[1])return!0;var a,u,d=s[0].split("-");if(a=d[0],u=d[1],!e[a]||u&&!e[u])return!0;"w"===n?t.lookup():i.includes(n)&&r.markers[n]?t.emit("pressed:marker-key",e,n):t.emit("pressed:hotkey",n)}else"w"===n&&!r.shortcuts.w[0]&&r.shortcuts.w[1]?t.lookup():!r.markers[n]||i.includes(n)&&r.shortcuts[n]&&(r.shortcuts[n][0]||!r.shortcuts[n][1])||t.emit("pressed:marker-key",e,n)}))},lookup:function(){var e=window.getSelection().toString();e&&this.emit("lookup:word",e)},checkURL:function(){var e=this;this.request("check:url",this.url).then(function(t){t&&e.onUrlFound(t)})},unset:function(e){s.default.name&&s.default.name===e&&(s.default.name=void 0,s.default.entry=null,this.emit("unset:entry"))},update:function(e,t){(t||e.url.split("#")[0]===this.url)&&(s.default.name=e.name,s.default.isNew=!1,s.default.entry=e,this.emit("set:entry"))},onHotkey:function(e){"w"===e&&this.lookup()},onUrlFound:function(e){this.update(e,!0),!this.active||this.initialized||document.querySelector("[data-tm-id]")||(this.initialized=!0,this.emit("restore:marks",e))},onSelectionChange:function(){this.emit("changed:selection",!window.getSelection().isCollapsed)}})};var o,i=n(0),r=n(7),s=(o=r)&&o.__esModule?o:{default:o}},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i={},r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"on",value:function(e,t){i[e]||(i[e]=[]),i[e].push(t)}},{key:"emit",value:function(e){for(var t=this,n=arguments.length,o=Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];for(var s=0,a=(e=e.split(" ")).length,u=void 0;s<a;s++)(u=i[e[s]])&&u.forEach(function(e){return e.apply(t,o)})}},{key:"request",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return browser.runtime.sendMessage({ev:e,args:n,wait:!0}).catch(function(){})}},{key:"proxy",value:function(e,t){for(var n=arguments.length,o=Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return function(){for(var n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return t.apply(e,o.concat(i))}}}]),e}();t.default=r},40:function(e,t,n){"use strict";var o=n(0),i=(l(n(7)),l(n(39))),r=l(n(38)),s=l(n(37)),a=l(n(34)),u=l(n(33)),d=l(n(31));function l(e){return e&&e.__esModule?e:{default:e}}new o._MODULE({events:{ENV:{"started:app":"autoinit","toggled:addon":"power"}},bootstrapped:!1,autoinit:function(){var e=this;browser.storage.sync.get().then(function(t){t&&t.settings&&t.history&&t.settings.addon.active&&e.power(!0)})},power:function(e){if(!e||this.bootstrapped)return!1;(0,i.default)(),(0,r.default)(),(0,a.default)(),(0,s.default)(),(0,u.default)(),(0,d.default)(),this.bootstrapped=!0}})},41:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0);t.default=new o._PORT({name:"injection",type:"content",events:{ONEOFF:["finished:restoration","failed:restoration","succeeded:restoration","copy:marks","save:entry?","update:entry?","lookup:word","error:browser-console","changed:selection","unsaved-changes","clicked:mark","added:bookmark","removed:bookmark","added:note","removed:last-note"]}})},42:function(e,t,n){"use strict";n(93);var o,i=n(0);(o=i)&&o.__esModule;n(41),n(7),n(40)},5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var n in t)e[n]||(e[n]=t[n]);return e}},6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t._COPY=function e(t,n){for(var i in n=n||{},t)t.hasOwnProperty(i)&&("object"===o(t[i])?(n[i]=Array.isArray(t[i])?[]:{},e(t[i],n[i])):n[i]=t[i]);return n}},7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0);t.default=new o._MODULE({events:{ENV:{"toggled:sync":"setAreas"}},initialized:!1,area_settings:"sync",area_history:"sync",area_entry:"sync",pdf:!1,iframe:!1,name:void 0,isNew:!0,entry:null,tmid:"",setAreas:function(){var e=this;return browser.storage.sync.get().then(function(t){t&&t.sync&&(e.area_settings=t.sync.settings?"sync":"local",e.area_history=t.sync.history?"sync":"local")})},get:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"storage";if(!this["_get_"+t])throw"field "+t+" doesn't exist";return this.initialized?this["_get_"+t]():(this.initialized=!0,this.setAreas().then(function(){return e["_get_"+t]()}))},_get_history:function(){return browser.storage.sync.get().then(function(e){var t=e.history;return browser.storage.local.get().then(function(e){var n=e.history;if(!t)return n;if(!n)return t;for(var o in t.order=t.order.concat(n.order),n.entries)t.entries[o]=n.entries[o];return t})})},_get_settings:function(){return browser.storage[this.area_settings].get().then(function(e){return e.settings})},_get_bmicon:function(){return browser.storage[this.area_settings].get().then(function(e){return!e||!e.settings||e.settings.misc.bmicon})},_get_noteicon:function(){return browser.storage[this.area_settings].get().then(function(e){return!e||!e.settings||e.settings.misc.noteicon})},_get_noteonclick:function(){return browser.storage[this.area_settings].get().then(function(e){return!e||!e.settings||e.settings.misc.noteonclick})},_get_tmuipos:function(){return browser.storage[this.area_settings].get().then(function(e){return!e||!e.settings||e.settings.misc.tmuipos})},_get_autosave:function(){return browser.storage[this.area_settings].get().then(function(e){return!(!e||!e.settings)&&e.settings.history.autosave})},_get_markers:function(){return browser.storage[this.area_settings].get().then(function(e){return e.settings.markers})},_get_shortcuts:function(){return browser.storage[this.area_settings].get().then(function(e){return e.settings.shortcuts})},_get_mode:function(){return browser.storage[this.area_settings].get().then(function(e){return!(e&&e.settings&&!e.settings.addon.active)})},_get_naming:function(){return browser.storage[this.area_settings].get().then(function(e){return e&&e.settings?e.settings.history.naming:"custom"})}})},9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){document.addEventListener("DOMContentLoaded",function(){
/*
* Translates a HTMl page in the web l10n style from the Add-on SDK with WebExtensions strings.
* Modified by underflyingbirches
*
* @author Martin Giger
* @see {@link https://gist.github.com/freaktechnik/4a72bc0711d9bc82cf3b075bcc292953}
* @license MPL-2.0
*/
return function(){var e=void 0,t=void 0,n=void 0;document.documentElement.setAttribute("lang",browser.i18n.getUILanguage().replace("_","-"));var o=document.querySelectorAll("*[data-l10n-id]"),i=document.querySelectorAll("*[data-l10n-attr]"),r=!0,s=!1,a=void 0;try{for(var u,d=o[Symbol.iterator]();!(r=(u=d.next()).done);r=!0){e=u.value;var l=(n=e.dataset).l10nId;l&&(t=browser.i18n.getMessage(l))&&"??"!=t&&(e.textContent=t)}}catch(e){s=!0,a=e}finally{try{!r&&d.return&&d.return()}finally{if(s)throw a}}var c=!0,h=!1,f=void 0;try{for(var p,v=i[Symbol.iterator]();!(c=(p=v.next()).done);c=!0)e=p.value,n=e.dataset,["Title","Placeholder"].forEach(function(o){var i=n["l10n"+o];i&&(t=browser.i18n.getMessage(i))&&"??"!=t&&e.setAttribute(o.toLowerCase(),t)})}catch(e){h=!0,f=e}finally{try{!c&&v.return&&v.return()}finally{if(h)throw f}}}()},{capture:!1,passive:!0,once:!0})}},93:function(e,t){}});