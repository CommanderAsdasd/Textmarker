!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=75)}([,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._MODULE=void 0;var r,o=n(4),i=(r=o)&&r.__esModule?r:{default:r};e._MODULE=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));for(i in t)n[i]=t[i];var r=n.events,o=void 0,i=void 0,s=void 0,a=void 0;if(r&&(o=r.ENV))for(s in o)n[a=o[s]]&&n.on(s,n.proxy(n,n[a]));return!n.autoinit||n.autoinit(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i.default),e}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=new(n(1)._MODULE)({autoinit:function(){var t=this;window.addEventListener("error",function(e){var n=e.filename.split("/").pop();["sidebar.wp.js","tbb-menu.wp.js","options.wp.js","addon-page.wp.js"].includes(n)&&t.emit("error:browser-console",{message:e.message,location:e.filename.split("/").pop().split(".").shift()+":"+e.lineno+":"+e.colno,time:(new Date).getTime()})},!1)}});e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._PORT=void 0;var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(1);e._PORT=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));n.port=null;var r=n.type;browser.runtime.onMessage.addListener(n.proxy(n,n.passMessage)),"privileged"!==r&&"background"!==r||n.initPorting();var o=n.events,i=void 0,s=void 0;if(o){if(i=o.ONEOFF){var a=!0,u=!1,c=void 0;try{for(var g,d=i[Symbol.iterator]();!(a=(g=d.next()).done);a=!0){var f=g.value;n.on(f,n.proxy(n,n.sendMessage,f))}}catch(t){u=!0,c=t}finally{try{!a&&d.return&&d.return()}finally{if(u)throw c}}}if(s=o.CONNECTION){var l=!0,h=!1,p=void 0;try{for(var y,_=s[Symbol.iterator]();!(l=(y=_.next()).done);l=!0){var v=y.value;n.on(v,n.proxy(n,n.postMessage,v))}}catch(t){h=!0,p=t}finally{try{!l&&_.return&&_.return()}finally{if(h)throw p}}}}return n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,o._MODULE),r(e,[{key:"passMessage",value:function(t,e,n){t.args=t.args||[];var r=[].concat(t.ev,t.args);return e&&e.name||(r=r.concat(e,n)),this.emit.apply(this,r),!!t.wait}},{key:"sendMessage",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o=this.type,i={ev:t,args:n};if("content"===o)browser.runtime.sendMessage(i).catch(function(){});else if("background"===o){var s=n[n.length-1];void 0!==s&&s.tab?browser.tabs.sendMessage(s.tab,i).catch(function(){}):browser.tabs.query({}).then(function(t){var e=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var a=o.value;browser.tabs.sendMessage(a.id,i).catch(function(){})}}catch(t){n=!0,r=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw r}}})}}},{key:"postMessage",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var o={ev:t,args:n};this.port&&this.port.postMessage(o)}},{key:"initPorting",value:function(){this.postponeConnection?this.addConnectionListeners(this.proxy(this,this.connect)):(this.connect(),this.addConnectionListeners())}},{key:"connect",value:function(){var t=this;(this.port=this.port||browser.runtime.connect({name:this.name})).onDisconnect.addListener(function(){return t.port=null})}},{key:"addConnectionListeners",value:function(t){var e=this;browser.runtime.onConnect.addListener(function(n){n.onMessage.addListener(e.proxy(e,e.passMessage)),!t||t()})}}]),e}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var o={},i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r(t,[{key:"on",value:function(t,e){o[t]||(o[t]=[]),o[t].push(e)}},{key:"emit",value:function(t){for(var e=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var s=0,a=(t=t.split(" ")).length,u=void 0;s<a;s++)(u=o[t[s]])&&u.forEach(function(t){return t.apply(e,r)})}},{key:"request",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return browser.runtime.sendMessage({ev:t,args:n,wait:!0}).catch(function(){})}},{key:"proxy",value:function(t,e){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return function(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return e.apply(t,r.concat(o))}}}]),t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){for(var n in e)t[n]||(t[n]=e[n]);return t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e._COPY=function t(e,n){for(var o in n=n||{},e)e.hasOwnProperty(o)&&("object"===r(e[o])?(n[o]=Array.isArray(e[o])?[]:{},t(e[o],n[o])):n[o]=e[o]);return n}},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e._ERRORTRACKER=e._PORT=e._MODULE=e._EXTEND=e._COPY=void 0;var r=n(6),o=u(n(5)),i=n(1),s=n(3),a=u(n(2));function u(t){return t&&t.__esModule?t:{default:t}}e._COPY=r._COPY,e._EXTEND=o.default,e._MODULE=i._MODULE,e._PORT=s._PORT,e._ERRORTRACKER=a.default},,,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,o=n(8),i=n(19),s=(r=i)&&r.__esModule?r:{default:r};e.default=new o._MODULE({initialized:!1,area_settings:s.default.sync.settings?"sync":"local",area_history:s.default.sync.history?"sync":"local",init:function(){var t=this;return browser.storage.sync.remove("logs"),browser.storage.local.get().then(function(e){var n=e&&e.sync?e.sync:s.default.sync;return t._set_sync(n)})},get:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"storage";if(!this["_get_"+e])throw"field "+e+" doesn't exist";return this.initialized?this["_get_"+e]():(this.initialized=!0,this.init().then(function(){return t["_get_"+e]()}))},set:function(t,e){if(!this["_set_"+t])throw"field "+t+" doesn't exist";return this["_set_"+t](e)},update:function(t,e,n){if(!this["_update_"+t])throw"field "+t+" doesn't exist";return this["_update_"+t](e,n)},sync:function(t,e){return this._get_history().then(function(n){if(!n.entries.hasOwnProperty(t))throw"entry doesnt exist";var r=(0,o._COPY)(n.entries[t]);return browser.storage.sync.get().then(function(n){var i=void 0;return n.history.entries.hasOwnProperty(t)&&(i=n.history.entries[t]),e&&i?i.synced=e:e&&!i?(n.history.entries[t]=(0,o._COPY)(r),n.history.order.push(t),n.history.entries[t].synced=e):!e&&i&&(delete n.history.entries[t],n.history.order.splice(n.history.order.indexOf(t),1)),browser.storage.sync.set({history:n.history})}).then(function(){return browser.storage.local.get().then(function(n){var i=void 0;return n.history.entries.hasOwnProperty(t)&&(i=n.history.entries[t]),!e&&i?i.synced=e:e||i?e&&i&&(delete n.history.entries[t],n.history.order.splice(n.history.order.indexOf(t),1)):(n.history.entries[t]=(0,o._COPY)(r),n.history.order.push(t),n.history.entries[t].synced=e),browser.storage.local.set({history:n.history})})})})},isEmpty:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sync";return browser.storage[t].get().then(function(t){return!t||!Object.keys(t).length&&t.constructor===Object||!t.history})},_get_storage:function(){var t=this;return browser.storage.local.get().then(function(e){return browser.storage.sync.get().then(function(n){return["version","logs"].forEach(function(t){e[t]=e[t]||n[t]}),"sync"===t.area_settings&&(e.settings=n.settings),t._get_history().then(function(t){return e.history=t,e})})})},_get_local_storage:function(){return browser.storage.local.get()},_get_synced_storage:function(){return browser.storage.sync.get()},_get_history:function(){return browser.storage.sync.get().then(function(t){var e=t.history;return browser.storage.local.get().then(function(t){var n=t.history;if(!e)return n;if(!n)return e;for(var r in e.order=e.order.concat(n.order),n.entries)e.entries[r]=n.entries[r];return e})})},_get_settings:function(){return browser.storage[this.area_settings].get().then(function(t){return t.settings})},_get_logs:function(){return browser.storage.local.get().then(function(t){return t&&t.logs?t.logs:[]})},_get_version:function(){return browser.storage.local.get().then(function(t){return t&&t.version?t.version:browser.storage.sync.get().then(function(t){return t.version||""})})},_get_mode:function(){return browser.storage[this.area_settings].get().then(function(t){return!(t&&t.settings&&!t.settings.addon.active)})},_get_privsave:function(){return browser.storage[this.area_settings].get().then(function(t){return!(!t||!t.settings)&&t.settings.history.saveInPriv})},_get_naming:function(){return browser.storage[this.area_settings].get().then(function(t){return t&&t.settings?t.settings.history.naming:"custom"})},_get_markers:function(){return browser.storage[this.area_settings].get().then(function(t){return t.settings.markers})},_get_shortcuts:function(){return browser.storage[this.area_settings].get().then(function(t){return t.settings.shortcuts})},_set_storage:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._set_settings(e).then(function(){return t._set_history(e)})},_set_sync:function(t){var e=this;return browser.storage.local.set({sync:t}).then(function(){return browser.storage.sync.set({sync:t})}).then(function(){e.area_settings=t.settings?"sync":"local",e.area_history=t.history?"sync":"local"})},_set_settings:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.area_settings;return browser.storage[t].get().then(function(e){if(!e||!e.settings)return browser.storage[t].set({settings:(0,o._COPY)(s.default.settings)})})},_set_history:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.area_history;return browser.storage[t].get().then(function(e){if(!e||!e.history)return browser.storage[t].set({history:(0,o._COPY)(s.default.history)})})},_set_version:function(t){return browser.storage.local.set({version:t}).then(function(){return browser.storage.sync.set({version:t})})},_set_log:function(t){return t.clear?browser.storage.local.set({logs:[]}):this._get_logs().then(function(e){return e.push(t),e.length>200&&e.shift(),browser.storage.local.set({logs:e})})},_set_entry:function(t){var e=this;return browser.storage[this.area_history].get().then(function(n){var r=n.history;return r.order.includes(t.name)?e._update_entry(t):(r.order.push(t.name),r.entries[t.name]=t,browser.storage[e.area_history].set({history:r}))})},_update_history:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.area_history;return browser.storage[e].get().then(function(n){n.history||(n.history=(0,o._COPY)(s.default.history));var r=t(n.history);return browser.storage[e].set({history:r}).then(function(){return r})})},_update_settings:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.area_settings;return browser.storage[e].get().then(function(n){n.settings||(n.settings=(0,o._COPY)(s.default.settings));var r=t(n.settings);return browser.storage[e].set({settings:r}).then(function(){return r})})},_update_sync:function(t){var e={};return e.settings="sync"===this.area_settings,e.history="sync"===this.area_history,this._set_sync(t(e))}})},,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={note_pbm:1,note_restoration_failure:2,note_url:3,error_save_style:4,error_save__toggle_sc:5,error_save_change_sc:6,error_save_ctm:7,error_save_autosave:8,error_save_naming:9,error_save_notify:10,error_save_download:11,error_save_bmicon:12,error_clean_history:13,error_add_marker:14,error_remove_marker:15,error_save_entry:16,error_update_entry:17,error_del_entry:18,error_empty_synced_storage_onstart:19,error_empty_synced_storage_onupdate:20,error_empty_local_storage_onstart:21,error_import_empty:22,error_import_history:23,error_import_settings:24,error_import_outdated:25,error_import_history_not_found:26,error_import_settings_not_found:27,error_naming:28,error_storage_migration:29,error_empty_local_storage_onupdate:30,error_toggle_sync:31,error_save_priv:32,getKeyByValue:function(t){for(var e in this)if(this[e]==t)return e;return""}}},,,,function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={version:browser.runtime.getManifest().version,settings:{shortcuts:{z:["ctrlKey-altKey",!0],y:["ctrlKey-altKey",!0],s:["ctrlKey-altKey",!0],c:["ctrlKey-altKey",!1],b:["ctrlKey-altKey",!0,!0],d:["","",!0],"-b":["","",!0],m:["",!0,!0],w:["",!0,!0],n:["","",!0],2:["",!0],3:["",!0]},markers:{2:"background-color:#cc0000;color:#ffffff;",3:"background-color:#ffc500;",m:"background-color:#ffee66;"},history:{autosave:!0,saveInPriv:!1,naming:"title",download:"text",copy:"text",saveNote:!0,sorted:"date-last",view:"list",pp:10},addon:{active:!0},misc:{bmicon:!0,noteicon:!0,noteonclick:!0,overwrite:!1,failureNote:!0,successNote:!0,pbmNote:!0,changedNote:!1,errorNote:!0,customSearch:!1,tmuipos:"top-right"}},history:{entries:{},order:[]},sync:{settings:!1,history:!1}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";var r,o=n(13),i=(r=o)&&r.__esModule?r:{default:r};new(n(8)._MODULE)({events:{ENV:{"started:app":"registerStorageChangedHandler","toggled:addon":"saveActivationState","toggle:sync":"toggleSync","change:style-setting":"changeStyle","change:bg-setting":"changeBgColor","toggle:shortcut-setting":"toggleShortcutSetting","change:shortcut-setting":"changeShortcutSetting","toggle:ctm-setting":"toggleCtmSetting","change:saveopt-setting":"changeSaveOpt","toggle:priv-setting":"togglePrivSaveOpt","change:namingopt-setting":"changeNamingOpt","toggle:noteopt-setting":"toggleNoteOpt","toggle:quickbuttonopt-setting":"toggleQuickbuttonOpt","toggle:notification-setting":"toggleNotificationOpt","toggle:misc-setting":"changeMiscSetting","change:misc-setting":"changeMiscSetting","change:sort-setting":"changeSortOpt","change:view-setting":"changeViewOpt","change:custom-search-setting":"changeCustomSearch","changed:per-page-count":"changeCountPerPage","sidebar:toggle-autosave":"changeSaveOpt","remove:custom-marker":"removeCustomMarker","add:custom-marker":"addCustomMarker","named:entry":"saveEntry","granted:update-entry":"updateEntry","delete:entries":"deleteEntries","finished:restoration":"updateEntryOnRestoration","clean:entries":"cleanEntries","sync:entry":"syncEntry","tag:entries":"tagEntries"}},updateOnChangedSync:!1,saveActivationState:function(t){i.default.update("settings",function(e){return e.addon.active=t,e})},toggleSync:function(t,e){var n=this;i.default.update("sync",function(n){return n[t]=e,n}).catch(function(){n.emit("error","error_toggle_sync"),n.emit("failed:toggle-sync",t)}).then(function(){return n.emit("toggled:sync toggled:sync-"+t,t,e)})},updateSettings:function(t,e,n){var r=this;i.default.update("settings",t).then(function(){return r.emit("updated:"+e+"-settings")}).catch(function(){n&&r.emit("error",n)})},addCustomMarker:function(t,e){this.updateSettings(function(n){return n.markers[t]=e,n},"marker","error_add_marker")},removeCustomMarker:function(t){this.updateSettings(function(e){return delete e.markers[t],e},"marker","error_remove_marker")},changeStyle:function(t,e){if(!t)return!1;this.updateSettings(function(n){return n.markers[t]=e,n},"style","error_save_style")},changeBgColor:function(t,e){this.updateSettings(function(n){var r=n.markers[t];if(r)for(var o=r.split(";"),i=o.length;i--;)if(o[i].includes("background-color")){n.markers[t]=r.replace(/background-color:#.{6}/,"background-color:"+e);break}return n},"bg-color","error_save_style")},toggleShortcutSetting:function(t,e){this.updateSettings(function(n){return n.shortcuts[t][1]=e,n},"shortcut","error_save__toggle_sc")},changeShortcutSetting:function(t,e){this.updateSettings(function(n){return n.shortcuts[t][0]=e,n},"shortcut","error_save_change_sc")},changeSortOpt:function(t){this.updateSettings(function(e){return e.history.sorted=t,e},"sort")},changeViewOpt:function(t){this.updateSettings(function(e){return e.history.view=t,e},"view")},changeCustomSearch:function(t){this.updateSettings(function(e){return e.misc.customSearch=t,e},"custom-search","error_save_change_search")},changeCountPerPage:function(t){this.updateSettings(function(e){return e.history.pp=t,e},"count-per-page")},toggleCtmSetting:function(t,e){this.updateSettings(function(n){return n.shortcuts[t][2]=e,n},"ctm","error_save_ctm")},changeSaveOpt:function(t){this.updateSettings(function(e){return e.history.autosave=t,e},"saveopt","error_save_autosave")},togglePrivSaveOpt:function(t){this.updateSettings(function(e){return e.history.saveInPriv=t,e},"privsaveopt","error_save_priv")},changeNamingOpt:function(t){this.updateSettings(function(e){return e.history.naming=t,e},"naming","error_save_naming")},toggleNoteOpt:function(t){this.updateSettings(function(e){return e.history.saveNote=t,e},"noteopt","error_save_notify")},toggleQuickbuttonOpt:function(t,e){this.updateSettings(function(n){return n.history[t]=e,n},"quickbutton","error_save_download")},toggleNotificationOpt:function(t,e){this.updateSettings(function(n){return n.misc[t]=e,n},"notification","error_save_notify")},changeMiscSetting:function(t,e){this.updateSettings(function(n){return n.misc[t]=e,n},"misc","error_save_bmicon")},cleanEntries:function(t,e){var n=this;if(t.length){e="string"==typeof e?e:"sync";var r=[];return i.default.update("history",function(e){for(var n=t.length,o=void 0;n--;)o=t[n],e.entries[o]?e.entries[o].lost.length=0:r.push(o);return e},e).then(function(){"local"===e&&n.emit("cleaned:entries")}).catch(function(){return n.emit("error","error_clean_history")}).then(function(){"sync"===e&&r.length&&n.cleanEntries(r,"local")})}},saveEntry:function(t){var e=this;t.lost=[],i.default.set("entry",t).then(function(){return e.emit("saved:entry",t)}).catch(function(){return e.emit("failed:save-entry","error_save_entry")})},updateEntry:function(t){var e=this;i.default.update("history",function(e){var n=t.name,r=e.entries[n].lost;return e.entries[n]=t,e.entries[n].lost=r||[],e},t.synced?"sync":"local").then(function(){return e.emit("updated:entry")}).catch(function(){return e.emit("failed:update-entry","error_update_entry")})},deleteEntries:function(t,e){var n=this;if(t.length){e="string"==typeof e?e:"sync";var r=[];return i.default.update("history",function(e){for(var o=void 0,i=void 0;t.length;)o=t.pop(),i=e.order.indexOf(o),delete e.entries[o],-1!==i?e.order.splice(i,1):r.push(o),n.emit("deleted:entry",o);return e},e).catch(function(){return n.emit("failed:delete-entries","error_del_entry")}).then(function(){"sync"===e&&r.length&&n.deleteEntries(r,"local")}).then(function(){return n.emit("deleted:entries")})}},updateEntryOnRestoration:function(t,e,n,r){i.default.update("history",function(r){var o=r.entries[t].lost;return r.entries[t].marks=e,r.entries[t].lost=o.concat(n),r},r)},syncEntry:function(t,e){var n=this;i.default.sync(t,e).then(function(){return n.emit("synced:entry")}).catch(function(){return n.emit("failed:sync-entry",t)})},tagEntries:function(t,e){var n=this;i.default.update("history",function(n){var r=n.entries;return t.sync.forEach(function(t){return r[t].tag=e}),n},"sync").then(function(){return i.default.update("history",function(n){var r=n.entries;return t.local.forEach(function(t){return r[t].tag=e}),n},"local")}).then(function(){return n.emit("tagged:entries")})},registerStorageChangedHandler:function(){browser.storage.onChanged.addListener(this.proxy(this,this.onStorageChanged))},onStorageChanged:function(t){t.settings&&this.emit("updated:settings"),t.history&&this.emit("updated:history")}})},function(t,e,n){"use strict";var r=i(n(13)),o=i(n(19));function i(t){return t&&t.__esModule?t:{default:t}}new(n(8)._MODULE)({events:{ENV:{"update:app":"setStorageOnUpgrade","install:app":"setStorageOnUpgrade","check:storage":"checkStorageOnStart","import:storage":"importStorage"}},updateSettings:function(t){var e="pbmNote changedNote errorNote successNote".split(" "),n=o.default.settings;return t.shortcuts?(e.forEach(function(e){t.misc[e]||(t.misc[e]=n.misc[e])}),t.history.sorted||(t.history.sorted=n.history.sorted),t.history.view||(t.history.view=n.history.view),"boolean"!=typeof t.history.saveInPriv&&(t.history.saveInPriv=n.history.saveInPriv),t.shortcuts.n||(t.shortcuts.n=n.shortcuts.n,t.misc.noteicon=n.misc.noteicon,t.misc.noteonclick=n.misc.noteonclick),t.misc.tmuipos||(t.misc.tmuipos=n.misc.tmuipos)):t=n,t},updateHistory:function(t){var e=t.entries,n=t.order,r=n?n.length:0,o=void 0;if(!r)return t;for(;r--;)(o=this.fixHistoryDates(e[n[r]])).synced=void 0===o.synced||o.synced;return t},fixHistoryDates:function(t){var e=browser.i18n.getMessage("lng");return"number"!=typeof t.first&&(t.first=new Date((t.first[e]||t.first.en||t.first.de||t.first).replace(/\./g," ")).getTime()),"number"!=typeof t.last&&(t.last=new Date((t.last[e]||t.last.en||t.last.de||t.last).replace(/\./g," ")).getTime()),t},fixHistory:function(t){var e=(t=t||{}).entries||{},n=t.order||[],r=n.length;if(r)for(;r--;)e[n[r]]||n.splice(r,1);for(var o in e)n.includes(o)||n.push(o);return t},mergeHistories:function(t,e){return r.default.update("history",function(n){for(var r=t.order,o=t.entries,i=r.length,s=0,a=n.order,u=n.entries,c=void 0;s<i;s++)c=r[s],a.includes(c)||(a.push(c),u[c]=o[c],u[c].synced="sync"===e);return n},e)},setStorageOnUpgrade:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"2",n=arguments[1];r.default.isEmpty("sync").then(function(e){return e&&"install"!==n&&t.emit("error","error_empty_synced_storage_onupdate"),r.default.set("storage","sync")}).then(function(){e<"4"&&r.default.update("settings",function(e){return t.updateSettings(e)},"sync")}).then(function(){e<"4"&&r.default.update("settings",function(e){return t.updateSettings(e)},"local")}).then(function(){e<"3"&&r.default.update("history",function(e){return t.updateHistory(e)},"sync")}).then(function(){return r.default.set("storage","local")}).then(function(){return t.emit("initialized:storage",e)}).catch(function(){t.emit("initialized:storage",e),t.emit("error","error_storage_migration")})},checkStorageOnStart:function(){var t=this;r.default.isEmpty("sync").then(function(e){return e&&t.emit("error","error_empty_synced_storage_onstart"),r.default.set("storage","sync")}).then(function(){return r.default.isEmpty("local").then(function(e){return e&&t.emit("error","error_empty_local_storage_onstart"),r.default.set("storage","local")})}).then(function(){return t.emit("checked:storage")}).catch(function(){return t.emit("checked:storage")})},importStorage:function(t,e){var n=this,r=t.settings,o=t.history;o||r?o?r?this.importSettings(r,e).then(function(t){n.importHistory(o,e).then(function(e){t?"outdated"===t?e?n.emit("error:import imported:history","error_import_outdated"):n.emit("failed:import","error_import_history","error_import_outdated"):e?n.emit("imported:storage imported:settings imported:history"):n.emit("error:import imported:settings","error_import_history"):e?n.emit("error:import imported:history","error_import_settings"):n.emit("failed:import","error_import_settings","error_import_history")})}):this.importHistory(o,e).then(function(t){t?n.emit("imported:storage imported:history"):n.emit("failed:import","error_import_settings_not_found","error_import_history")}):r.shortcuts?this.importSettings(r,e).then(function(t){t?n.emit("error:import imported:settings","error_import_history_not_found"):n.emit("failed:import","error_import_history_not_found","error_import_settings")}):this.emit("failed:import","error_import_history_not_found","error_import_outdated"):this.emit("failed:import","error_import_empty")},importSettings:function(t,e){var n=this;return t.shortcuts?r.default.update("settings",function(t){return n.updateSettings(t)},e).then(function(){return!0}).catch(function(){return!1}):Promise.resolve("outdated")},importHistory:function(t,e){return this.mergeHistories(this.updateHistory(this.fixHistory(t)),e).then(function(){return!0}).catch(function(){return!1})}})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return new s._MODULE({events:{ENV:{"toggled:addon":"toggle","updated:ctm-settings":"update"}},items:{m:{contexts:["selection"]},w:{contexts:["selection"]},d:{contexts:["page"]},b:{contexts:["page"]},"-b":{contexts:["page"]},n:{contexts:["page"]}},created:[],autoinit:function(){var t=this,e=void 0;for(var n in this.items)(e=this.items[n]).id=n,e.title=browser.i18n.getMessage("ctx_"+("-b"===n?"db":n)),e.onclick=function(e,n){return t.onClick(e,n)};this.update()},create:function(t){this.created.includes(t)||(browser.menus.create(this.items[t]),this.created.push(t))},remove:function(t){this.created.includes(t)&&(browser.menus.remove(t),this.created.splice(this.created.indexOf(t),1))},removeAll:function(){this.created.length&&(browser.menus.removeAll(),this.created=[])},toggle:function(t){t?this.update():this.removeAll()},update:function(){var t=this;this.created;i.default.get("shortcuts").then(function(e){for(var n in t.items)e[n][2]?t.create(n):t.remove(n)})},onClick:function(t,e){var n=t.menuItemId;"w"===n?this.emit("lookup:word",t.selectionText):this.emit("ctx:"+n,null,null,{tab:e.id})}})};var r,o=n(13),i=(r=o)&&r.__esModule?r:{default:r},s=n(8)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return new s._MODULE({events:{ENV:{"granted:save-entry":"name"}},maxChars:70,name:function(t){var e=this;if(t.name)return this.adjustName(t.name,t);i.default.get("naming").then(function(n){return e.adjustName(null,t,n)}).catch(function(){return e.emit("error","error_naming")})},adjustName:function(t,e,n){var r=this;t=(t=t||("title"===n?e.title:"date"===n?new Date(e.first).toLocaleString():"")).substring(0,this.maxChars-1),i.default.get("history").then(function(n){var o=r.getDoubleNameCount(n);o&&(t+=" ("+(o+1)+")"),e.name=t,r.emit("named:entry",e)}).catch(function(){return r.emit("error","error_naming")})},getDoubleNameCount:function(t){for(var e=t.order,n=e.length,r=0,o=void 0;n--;)o=e[n],this.isDoubleName(name,o)&&r++;return r},isDoubleName:function(t,e){if(t===e)return!0;var n,r=t.length;return t===e.substring(0,r)&&(n=e.substring(r,e.length),!!/^\s*\(\d+\)$/.test(n))}})};var r,o=n(13),i=(r=o)&&r.__esModule?r:{default:r},s=n(8)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return new i._MODULE({events:{ENV:{"view:entry":"openEntryDetailPage"}},openEntryDetailPage:function(t){var e=browser.extension.getURL("content/detail-view/detail-view.html");browser.windows.getCurrent().then(function(n){browser.windows.create({url:e+"#"+encodeURIComponent(t),type:"panel",height:n.height-22,width:Math.min(n.width,980),incognito:n.incognito})})}})};var r,o=n(13),i=((r=o)&&r.__esModule,n(8))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return new s._MODULE({events:{ENV:{"open:addon-page":"openAddonPage","lookup:word":"openSearch","open:entries":"open"}},urls:{news:"content/addon-page/addon-page.html#page=news",settings:"content/addon-page/addon-page.html#page=settings",history:"content/addon-page/addon-page.html#page=history",info:"content/addon-page/addon-page.html#page=new",help:"content/addon-page/addon-page.html#page=manual",contact:"content/addon-page/addon-page.html#page=contact",logs:"content/addon-page/addon-page.html#page=logs",export:"content/addon-page/addon-page.html#page=export",sync:"content/addon-page/addon-page.html#page=sync"},open:function(t){for(var e=this,n=(t="string"==typeof t?[t]:t).length,r=!1;n--;)browser.tabs.create({url:t[n]}).catch(function(){r||e.emit("failed:open-tab"),r=!0})},openAddonPage:function(t){this.open(this.urls[t])},openInitPage:function(t,e){t&&t<"3"?this.openAddonPage("help"):e&&"install"===e&&this.openAddonPage("help")},openSearch:function(t){var e=this;i.default.get("settings").then(function(n){var r=n.misc.customSearch,o=void 0;o=r?"https://"+r[0]+t+r[1]:"https://"+browser.i18n.getMessage("lng")+".wikipedia.org/wiki/"+t,e.open(o)})}})};var r,o=n(13),i=(r=o)&&r.__esModule?r:{default:r},s=n(8)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){return new s._MODULE({events:{ENV:{"saved:entry":"onSavedEntry","failed:save-entry":"onSaveError","failed:update-entry":"onSaveError","failed:delete-entries":"onDeleteError","failed:open-tab":"onOpenTabFailure","updated:entry":"onUpdatedEntry","failed:restoration":"onFailedRestoration","succeeded:restoration":"onSuccessfulRestoration","failed:pbm":"onFailedPBM","failed:import":"onFailedImport","error:import":"onImportError","imported:storage":"onImportSuccess",error:"onError"}},notify:function(t,e,n){i.default.get("settings").then(function(r){t(r)&&browser.notifications.create({type:"basic",title:"Textmarker: "+browser.i18n.getMessage(n),message:e,iconUrl:browser.extension.getURL("icons/tm48.png")})})},onSavedEntry:function(){this.notify(function(t){return t.history.saveNote},browser.i18n.getMessage("note_saved_entry"),"success")},onFailedPBM:function(){this.notify(function(t){return t.misc.pbmNote},browser.i18n.getMessage("note_pbm"),"error")},onOpenTabFailure:function(){this.notify(function(t){return!0},browser.i18n.getMessage("note_url"),"error")},onFailedImport:function(t,e){var n=browser.i18n.getMessage(t),r=e?"\n\n"+browser.i18n.getMessage(e):"";this.notify(function(t){return!0},browser.i18n.getMessage("note_import_failure",n+r),"error")},onImportError:function(t){this.notify(function(t){return!0},browser.i18n.getMessage("note_import_warning",browser.i18n.getMessage(t)),"warning")},onImportSuccess:function(){this.notify(function(t){return!0},browser.i18n.getMessage("note_import_success"),"success")},onUpdatedEntry:function(){this.notify(function(t){return t.misc.changedNote},browser.i18n.getMessage("note_updated_entry"),"success")},onSuccessfulRestoration:function(){this.notify(function(t){return t.misc.successNote},browser.i18n.getMessage("note_restoration_success"),"success")},onFailedRestoration:function(){this.notify(function(t){return t.misc.failureNote},browser.i18n.getMessage("note_restoration_failure"),"error")},onSaveError:function(t){this.notify(function(t){return t.history.saveNote},browser.i18n.getMessage("note_save_failure",browser.i18n.getMessage(t)),"error")},onDeleteError:function(t){this.notify(function(t){return t.misc.errorNote},browser.i18n.getMessage("note_error",browser.i18n.getMessage(t)),"error")},onError:function(t){this.notify(function(t){return t.misc.errorNote},browser.i18n.getMessage("note_error",browser.i18n.getMessage(t)),"error")}})};var r,o=n(13),i=(r=o)&&r.__esModule?r:{default:r},s=n(8)},function(t,e,n){"use strict";var r,o=n(13),i=(r=o)&&r.__esModule?r:{default:r};new(n(8)._MODULE)({events:{ENV:{"check:url":"checkUrl","save:entry?":"onSaveNewRequest","update:entry?":"onUpdateRequest","name:entry?":"onNamingRequest"}},checkUrl:function(t,e,n){var r=this;i.default.get("history").then(function(e){var o=e.entries,i=void 0;for(var s in o)if(i=o[s],t===r.getHashlessURL(i.url)){n(i);break}})},onNamingRequest:function(t,e){var n=this;return browser.windows.getLastFocused().then(function(t){var r=t.incognito;r&&n.emit("failed:pbm"),r?i.default.get("privsave").then(function(t){t?e(t):n.emit("failed:pbm")}):e(!r)})},onSaveNewRequest:function(t){var e=this;return browser.windows.getLastFocused().then(function(n){n.incognito?i.default.get("privsave").then(function(n){n?e.emit("granted:save-entry",t):e.emit("failed:pbm")}):e.emit("granted:save-entry",t)})},onUpdateRequest:function(t){var e=this;return browser.windows.getLastFocused().then(function(n){n.incognito?i.default.get("privsave").then(function(n){n?e.emit("granted:update-entry",t):e.emit("failed:pbm")}):e.emit("granted:update-entry",t)})},getHashlessURL:function(t){var e=t.lastIndexOf("#");return-1===e?t:t.substr(0,e)}})},function(t,e,n){"use strict";var r=s(n(13)),o=n(8),i=s(n(15));function s(t){return t&&t.__esModule?t:{default:t}}new o._MODULE({events:{ENV:{error:"log",warning:"log","failed:save-entry":"log","failed:update-entry":"log","failed:delete-entry":"log","failed:restoration":"onFailedRestoration","failed:pbm":"onFailedPBM","failed:open-tab":"onOpenTabFailure","error:import":"log","error:browser-console":"log","clear:logs":"clear"}},log:function(t){var e=this,n=void 0;n=t.time?[t.time,t.message+" ["+t.location+"]"]:[(new Date).getTime(),i.default[t]],r.default.set("log",n).then(function(){return e.emit("updated:logs logged:error",n)})},clear:function(){var t=this;r.default.set("log",{clear:!0}).then(function(){return t.emit("updated:logs")})},onFailedRestoration:function(){this.log("note_restoration_failure")},onOpenTabFailure:function(){this.log("note_url")},onFailedPBM:function(){this.log("note_pbm")}})},function(t,e,n){"use strict";new(n(8)._PORT)({name:"background",type:"background",postponeConnection:!0,events:{ONEOFF:["started:app","toggled:addon","toggled:sync","toggled:sync-settings","synced:entry","updated:settings","updated:history","updated:history-on-restoration","updated:logs","updated:ctm-settings","updated:misc-settings","updated:bg-color-settings","updated:custom-search-settings","updated:saveopt-settings","saved:entry","deleted:entry","deleted:entries","imported:settings","imported:history","ctx:m","ctx:d","ctx:b","ctx:-b","ctx:n","sidebar:highlight","sidebar:delete-highlight","sidebar:bookmark","sidebar:delete-bookmark","sidebar:note","sidebar:save-changes","sidebar:undo","sidebar:redo","sidebar:scroll-to-bookmark","sidebar:toggle-notes"],CONNECTION:["started:app","toggled:addon","updated:settings","updated:entry","saved:entry","toggled:sync-settings","changed:selection","unsaved-changes","clicked:mark","added:bookmark","removed:bookmark","added:note","removed:last-note"]}})},function(t,e){t.exports="../../icons/tm48.png"},function(t,e){t.exports="../../icons/off18.png"},function(t,e){t.exports="../../icons/off16.png"},function(t,e){t.exports="../../icons/on64.png"},function(t,e){t.exports="../../icons/on36.png"},function(t,e){t.exports="../../icons/on32.png"},function(t,e){t.exports="../../icons/on18.png"},function(t,e){t.exports="../../icons/on16.png"},function(t,e,n){"use strict";n(74),n(73),n(72),n(71),n(70),n(69),n(68),n(67);var r=n(8),o=(g(r),g(n(13)));n(66),n(65),n(64);var i=g(n(63)),s=g(n(62)),a=g(n(61)),u=g(n(60)),c=g(n(59));function g(t){return t&&t.__esModule?t:{default:t}}n(58),n(57),new r._MODULE({events:{ENV:{"imported:settings":"toggleOnImport","initialized:storage":"start","migrated:storage":"start","checked:storage":"start","toggle:addon":"toggle"}},active:!0,version:"",loadReason:"",autoinit:function(){var t=this,e=this.version=browser.runtime.getManifest().version;browser.runtime.onInstalled.addListener(function(n){o.default.get("version").then(function(r){if(!r||r!==e){var o=t.loadReason=n.reason,i=n.previousVersion||"2";!o||"update"!==o&&"install"!==o?t.emit("check:storage"):t.emit(o+":app",i,o)}})}),o.default.get("version").then(function(n){n&&n===e&&t.emit("check:storage")})},start:function(){var t=this;o.default.set("version",this.version),(0,i.default)(),(0,s.default)(),(0,u.default)(),(0,c.default)(),(0,a.default)(),o.default.get("mode").then(function(e){return t.activate(e)}).catch(function(){return t.activate(!0)}).then(function(){return t.emit("started:app",t.version,t.loadReason)})},activate:function(t){var e=this.active=t;this.toggleBrowserActionIcon(e)},toggle:function(){var t=!this.active;this.activate(t),this.emit("toggled:addon",t)},toggleOnImport:function(){var t=this;o.default.get("mode").then(function(e){return t.activate(e)})},toggleBrowserActionIcon:function(t){browser.browserAction.setIcon({path:t?{16:"../icons/on16.png",18:"../icons/on18.png",32:"../icons/on32.png"}:{16:"../icons/off16.png",18:"../icons/off18.png",32:"../icons/off32.png"}})}})}]);